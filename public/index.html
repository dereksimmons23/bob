<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scale=no">
  <meta name="theme-color" content="#0a0e1a">
  <meta name="description" content="Battle o' Brackets‚Ñ¢ - The party game where democracy gets dumb. Hosted by BOB.">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <title>Battle o' Brackets‚Ñ¢ | Hosted by BOB</title>
  <link rel="manifest" href="manifest.json">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Bangers&family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <style>
    :root {
      --bg-deep: #0a0e1a;
      --bg-card: #141a2e;
      --bg-card-hover: #1c2440;
      --accent-gold: #ffd700;
      --accent-red: #ff3b5c;
      --accent-green: #00e676;
      --accent-blue: #00b4ff;
      --accent-purple: #b388ff;
      --accent-orange: #ff9100;
      --accent-pink: #ff4081;
      --text-primary: #ffffff;
      --text-secondary: #8892b0;
      --text-muted: #4a5578;
      --font-display: 'Bangers', cursive;
      --font-body: 'Outfit', sans-serif;
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      font-family: var(--font-body);
      background: var(--bg-deep);
      color: var(--text-primary);
      min-height: 100vh;
      overflow-x: hidden;
    }

    body::before {
      content: '';
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: 
        radial-gradient(ellipse at 20% 20%, rgba(255, 215, 0, 0.03) 0%, transparent 50%),
        radial-gradient(ellipse at 80% 80%, rgba(0, 180, 255, 0.03) 0%, transparent 50%),
        radial-gradient(ellipse at 50% 50%, rgba(179, 136, 255, 0.02) 0%, transparent 70%);
      pointer-events: none;
      z-index: 0;
    }

    #root { position: relative; z-index: 1; min-height: 100vh; }

    @keyframes float {
      0%, 100% { transform: translateY(0px); }
      50% { transform: translateY(-10px); }
    }
    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }
    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      25% { transform: translateX(-5px) rotate(-1deg); }
      75% { transform: translateX(5px) rotate(1deg); }
    }
    @keyframes slideUp {
      from { opacity: 0; transform: translateY(30px); }
      to { opacity: 1; transform: translateY(0); }
    }
    @keyframes slideIn {
      from { opacity: 0; transform: translateX(-30px); }
      to { opacity: 1; transform: translateX(0); }
    }
    @keyframes scaleIn {
      from { opacity: 0; transform: scale(0.8); }
      to { opacity: 1; transform: scale(1); }
    }
    @keyframes glow {
      0%, 100% { box-shadow: 0 0 20px rgba(255, 215, 0, 0.3); }
      50% { box-shadow: 0 0 40px rgba(255, 215, 0, 0.6), 0 0 60px rgba(255, 215, 0, 0.3); }
    }

    .animate-float { animation: float 3s ease-in-out infinite; }
    .animate-pulse { animation: pulse 2s ease-in-out infinite; }
    .animate-shake { animation: shake 0.5s ease-in-out; }
    .animate-slideUp { animation: slideUp 0.5s ease-out forwards; }
    .animate-slideIn { animation: slideIn 0.5s ease-out forwards; }
    .animate-scaleIn { animation: scaleIn 0.4s ease-out forwards; }
    .animate-glow { animation: glow 2s ease-in-out infinite; }

    /* Bracket Path View - Seed's Eye Perspective */
    @keyframes pathPulse {
      0%, 100% { opacity: 0.3; }
      50% { opacity: 0.6; }
    }
    @keyframes bracketGlow {
      0%, 100% { filter: drop-shadow(0 0 8px var(--accent-gold)); }
      50% { filter: drop-shadow(0 0 20px var(--accent-gold)); }
    }
    @keyframes trophyFloat {
      0%, 100% { transform: translateY(0) scale(1); }
      50% { transform: translateY(-8px) scale(1.05); }
    }
    @keyframes advanceUp {
      from { transform: translateY(20px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }
    .bracket-path-container {
      perspective: 800px;
      perspective-origin: center bottom;
    }
    .bracket-path-track {
      transform-style: preserve-3d;
      transform: rotateX(15deg);
    }
    .path-node {
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    }
    .path-node:hover {
      transform: scale(1.05);
    }
    .path-connector {
      animation: pathPulse 2s ease-in-out infinite;
    }
    .trophy-destination {
      animation: trophyFloat 3s ease-in-out infinite, bracketGlow 2s ease-in-out infinite;
    }

    /* Battle Animations */
    @keyframes vsClash {
      0%, 100% { transform: scale(1); }
      25% { transform: scale(1.2) rotate(-5deg); }
      50% { transform: scale(0.9); }
      75% { transform: scale(1.15) rotate(5deg); }
    }
    @keyframes vsPulse {
      0%, 100% { text-shadow: 0 0 10px var(--accent-red), 0 0 20px var(--accent-red); }
      50% { text-shadow: 0 0 20px var(--accent-gold), 0 0 40px var(--accent-gold), 0 0 60px var(--accent-orange); }
    }
    @keyframes winnerCelebrate {
      0% { transform: scale(1); }
      25% { transform: scale(1.1) rotate(-2deg); }
      50% { transform: scale(1.15); }
      75% { transform: scale(1.1) rotate(2deg); }
      100% { transform: scale(1.1); }
    }
    @keyframes loserFade {
      from { opacity: 1; transform: scale(1); }
      to { opacity: 0.4; transform: scale(0.95); }
    }
    @keyframes entrantEnter {
      from { opacity: 0; transform: translateY(20px) scale(0.9); }
      to { opacity: 1; transform: translateY(0) scale(1); }
    }
    @keyframes votePopIn {
      0% { transform: scale(1); }
      50% { transform: scale(1.3); }
      100% { transform: scale(1); }
    }
    .vs-badge {
      animation: vsClash 2s ease-in-out infinite, vsPulse 1.5s ease-in-out infinite;
    }
    .entrant-card {
      animation: entrantEnter 0.5s ease-out forwards;
    }
    .entrant-winner {
      animation: winnerCelebrate 0.6s ease-out forwards;
    }
    .entrant-loser {
      animation: loserFade 0.5s ease-out forwards;
    }
    .vote-pop {
      animation: votePopIn 0.2s ease-out;
    }

    /* Button hover effects */
    button:not(:disabled):hover {
      transform: translateY(-2px);
      filter: brightness(1.1);
    }
    button:not(:disabled):active {
      transform: translateY(0);
      filter: brightness(0.95);
    }

    /* Lock In button pulse */
    @keyframes lockPulse {
      0%, 100% { box-shadow: 0 4px 15px rgba(0, 230, 118, 0.3); }
      50% { box-shadow: 0 4px 25px rgba(0, 230, 118, 0.5), 0 0 40px rgba(0, 230, 118, 0.2); }
    }
    .lock-in-btn {
      animation: lockPulse 2s ease-in-out infinite;
    }

    /* Scrollbar styling */
    ::-webkit-scrollbar { width: 8px; }
    ::-webkit-scrollbar-track { background: var(--bg-deep); }
    ::-webkit-scrollbar-thumb { background: var(--text-muted); border-radius: 4px; }
    ::-webkit-scrollbar-thumb:hover { background: var(--text-secondary); }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect, useCallback, useMemo, useRef } = React;

    // ============================================
    // SUPABASE CLIENT
    // ============================================
    const supabase = window.supabase.createClient(
      'https://vvroarbpvfsoiznkbfvt.supabase.co',
      'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZ2cm9hcmJwdmZzb2l6bmtiZnZ0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjYxOTgzMDQsImV4cCI6MjA4MTc3NDMwNH0.nI9kUemYIkVaAULWs3piPVfQeCoUqZ8CYGX8MwNn0Wk'
    );

    // ============================================
    // CATEGORY LIBRARY - 100+ Presets
    // ============================================
    const CATEGORY_LIBRARY = {
      food: {
        name: "Food & Drink",
        icon: "üçï",
        color: "var(--accent-orange)",
        categories: [
          { name: "Best Pizza Topping", entrants: ["Pepperoni", "Mushrooms", "Sausage", "Green Peppers", "Onions", "Black Olives", "Bacon", "Pineapple", "Jalape√±os", "Extra Cheese", "Anchovies", "Spinach", "Tomatoes", "Garlic", "Ham", "Chicken"] },
          { name: "Best Pizza Style", featured: true, entrants: ["New York", "Chicago Deep Dish", "Detroit", "Neapolitan", "Sicilian", "New Haven", "California", "St. Louis", "Grandma Style", "Roman", "Greek", "Tavern Style", "Stuffed Crust", "Wood-Fired", "Bar Pie", "Pan Pizza"] },
          { name: "Best Fast Food Chain", featured: true, entrants: ["McDonald's", "Chick-fil-A", "Wendy's", "Taco Bell", "Burger King", "Popeyes", "Five Guys", "In-N-Out", "Chipotle", "Shake Shack", "Arby's", "Panda Express", "Sonic", "Whataburger", "Jersey Mike's", "Raising Cane's"] },
          { name: "Best Ice Cream Flavor", entrants: ["Vanilla", "Chocolate", "Strawberry", "Cookies & Cream", "Mint Chocolate Chip", "Cookie Dough", "Rocky Road", "Butter Pecan", "Salted Caramel", "Coffee", "Pistachio", "Neapolitan", "Birthday Cake", "Peanut Butter Cup", "Cherry Garcia", "Moose Tracks"] },
          { name: "Best Breakfast Food", entrants: ["Pancakes", "Waffles", "French Toast", "Bacon", "Eggs Benedict", "Omelette", "Breakfast Burrito", "Bagel & Lox", "Cereal", "Avocado Toast", "Biscuits & Gravy", "Cinnamon Roll", "Fruit Bowl", "Hash Browns", "Smoothie Bowl", "Croissant"] },
          { name: "Best Thanksgiving Side", entrants: ["Mashed Potatoes", "Stuffing", "Green Bean Casserole", "Cranberry Sauce", "Sweet Potato Casserole", "Mac & Cheese", "Dinner Rolls", "Gravy", "Corn on the Cob", "Brussels Sprouts", "Cornbread", "Pumpkin Pie", "Pecan Pie", "Apple Pie", "Glazed Carrots", "Coleslaw"] },
          { name: "Best Candy", entrants: ["Reese's", "Snickers", "M&Ms", "Kit Kat", "Twix", "Skittles", "Sour Patch Kids", "Milky Way", "Butterfinger", "3 Musketeers", "Swedish Fish", "Jolly Ranchers", "Nerds", "Starburst", "Hershey's", "Almond Joy"] },
          { name: "Best Chip Flavor", featured: true, entrants: ["Classic/Original", "Sour Cream & Onion", "BBQ", "Salt & Vinegar", "Cheddar", "Ranch", "Jalape√±o", "Honey BBQ", "Loaded Baked Potato", "Dill Pickle", "Cool Ranch Doritos", "Nacho Cheese Doritos", "Flamin' Hot", "Kettle Cooked", "Lime", "All Dressed"] },
          { name: "Best Soda", entrants: ["Coca-Cola", "Pepsi", "Dr Pepper", "Sprite", "Mountain Dew", "Fanta", "7-Up", "Root Beer", "Ginger Ale", "Orange Crush", "Cherry Coke", "Cream Soda", "Grape Soda", "Sierra Mist", "Sunkist", "Big Red"] },
          { name: "Best Coffee Order", entrants: ["Black Coffee", "Latte", "Cappuccino", "Americano", "Espresso", "Mocha", "Cold Brew", "Iced Coffee", "Macchiato", "Flat White", "Frappuccino", "Irish Coffee", "Cortado", "Affogato", "Pour Over", "Red Eye"] },
          { name: "Best Cuisine", entrants: ["Italian", "Mexican", "Chinese", "Japanese", "Thai", "Indian", "Greek", "French", "Korean", "Vietnamese", "American", "Mediterranean", "Spanish", "Middle Eastern", "Ethiopian", "Brazilian"] },
        ]
      },
      music: {
        name: "Music",
        icon: "üéµ",
        color: "var(--accent-purple)",
        categories: [
          { name: "Best Band of All Time", featured: true, entrants: ["The Beatles", "Led Zeppelin", "Pink Floyd", "Queen", "The Rolling Stones", "Nirvana", "U2", "AC/DC", "Guns N' Roses", "Metallica", "The Who", "Fleetwood Mac", "Radiohead", "The Beach Boys", "Pearl Jam", "Red Hot Chili Peppers"] },
          { name: "Best Music Genre", entrants: ["Rock", "Pop", "Hip-Hop", "R&B", "Country", "Jazz", "Classical", "Electronic", "Metal", "Indie", "Folk", "Reggae", "Blues", "Soul", "Punk", "Alternative"] },
          { name: "Best Decade for Music", featured: true, entrants: ["1950s", "1960s", "1970s", "1980s", "1990s", "2000s", "2010s", "2020s"] },
          { name: "Best Musical Instrument", entrants: ["Guitar", "Piano", "Drums", "Violin", "Saxophone", "Bass", "Trumpet", "Flute", "Cello", "Harmonica", "Ukulele", "Banjo", "Clarinet", "Trombone", "Accordion", "Synthesizer"] },
          { name: "Best Album Cover", entrants: ["Dark Side of the Moon", "Abbey Road", "Nevermind", "The Velvet Underground & Nico", "Unknown Pleasures", "Thriller", "Sgt. Pepper's", "Rumours", "OK Computer", "London Calling", "Born in the USA", "Blue (Joni Mitchell)", "Purple Rain", "The Miseducation of Lauryn Hill", "Kid A", "Is This It"] },
          { name: "Best One-Hit Wonder", entrants: ["Toto - Africa", "A-ha - Take On Me", "Soft Cell - Tainted Love", "Dexys - Come On Eileen", "Lipps Inc - Funkytown", "Men at Work - Down Under", "The Vapors - Turning Japanese", "Tommy Tutone - 867-5309", "Nena - 99 Luftballons", "Chumbawamba - Tubthumping", "Right Said Fred - I'm Too Sexy", "Dexy's Midnight Runners", "Gotye - Somebody That I Used to Know", "Hanson - MMMBop", "Vanilla Ice - Ice Ice Baby", "Los Del Rio - Macarena"] },
        ]
      },
      movies: {
        name: "Movies & TV",
        icon: "üé¨",
        color: "var(--accent-red)",
        categories: [
          { name: "Best Movie Genre", entrants: ["Action", "Comedy", "Drama", "Horror", "Sci-Fi", "Romance", "Thriller", "Animation", "Documentary", "Fantasy", "Mystery", "Western", "Musical", "Crime", "Adventure", "War"] },
          { name: "Best Pixar Movie", entrants: ["Toy Story", "Finding Nemo", "The Incredibles", "Up", "WALL-E", "Monsters, Inc.", "Ratatouille", "Inside Out", "Coco", "Toy Story 3", "Finding Dory", "Cars", "Brave", "Soul", "Turning Red", "Elemental"] },
          { name: "Best Christmas Movie", featured: true, entrants: ["Home Alone", "Elf", "A Christmas Story", "It's a Wonderful Life", "Die Hard", "The Polar Express", "How the Grinch Stole Christmas", "National Lampoon's Christmas Vacation", "Miracle on 34th Street", "Love Actually", "A Charlie Brown Christmas", "The Santa Clause", "Scrooged", "White Christmas", "The Nightmare Before Christmas", "Rudolph the Red-Nosed Reindeer"] },
          { name: "Best Movie Villain", featured: true, entrants: ["Darth Vader", "The Joker", "Hannibal Lecter", "Thanos", "Lord Voldemort", "Hans Gruber", "Nurse Ratched", "Anton Chigurh", "Norman Bates", "Agent Smith", "Scar", "Hans Landa", "The Terminator", "Freddy Krueger", "Magneto", "Gollum"] },
          { name: "Best TV Show Ever", featured: true, entrants: ["Breaking Bad", "The Sopranos", "The Wire", "Game of Thrones", "Friends", "Seinfeld", "The Office", "The Simpsons", "Mad Men", "Lost", "Stranger Things", "The Crown", "Band of Brothers", "Succession", "The West Wing", "Arrested Development"] },
          { name: "Best Movie Snack", entrants: ["Popcorn", "M&Ms", "Milk Duds", "Twizzlers", "Nachos", "Raisinets", "Junior Mints", "Sour Patch Kids", "Hot Dog", "Pretzel Bites", "Gummy Bears", "Icee", "Cookie Dough Bites", "Reese's Pieces", "Red Vines", "Buncha Crunch"] },
          { name: "Best Disney Animated Movie", entrants: ["The Lion King", "Beauty and the Beast", "Aladdin", "The Little Mermaid", "Frozen", "Moana", "Mulan", "Tangled", "Cinderella", "Sleeping Beauty", "Snow White", "The Jungle Book", "Pocahontas", "Hercules", "Lilo & Stitch", "Encanto"] },
          { name: "Best Sitcom", entrants: ["Friends", "Seinfeld", "The Office", "Parks and Recreation", "How I Met Your Mother", "Brooklyn Nine-Nine", "Cheers", "Frasier", "30 Rock", "Arrested Development", "Schitt's Creek", "New Girl", "Community", "Modern Family", "It's Always Sunny", "Curb Your Enthusiasm"] },
        ]
      },
      sports: {
        name: "Sports",
        icon: "üèÄ",
        color: "var(--accent-green)",
        categories: [
          { name: "Best Sport to Watch", entrants: ["Football (NFL)", "Basketball (NBA)", "Baseball (MLB)", "Soccer", "Hockey (NHL)", "Tennis", "Golf", "MMA/UFC", "Boxing", "College Football", "College Basketball", "Formula 1", "Olympics", "Rugby", "Cricket", "Wrestling"] },
          { name: "Best NBA Team", entrants: ["Lakers", "Celtics", "Bulls", "Warriors", "Heat", "Spurs", "Knicks", "76ers", "Nets", "Mavericks", "Nuggets", "Bucks", "Suns", "Clippers", "Rockets", "Thunder"] },
          { name: "Best NFL Team", entrants: ["Cowboys", "Patriots", "Packers", "Steelers", "49ers", "Chiefs", "Bears", "Eagles", "Raiders", "Giants", "Broncos", "Dolphins", "Saints", "Ravens", "Bills", "Seahawks"] },
          { name: "Best Olympic Sport", entrants: ["Gymnastics", "Swimming", "Track & Field", "Basketball", "Soccer", "Volleyball", "Diving", "Figure Skating", "Skiing", "Snowboarding", "Boxing", "Wrestling", "Tennis", "Hockey", "Surfing", "Skateboarding"] },
          { name: "Best Athlete of All Time", featured: true, entrants: ["Michael Jordan", "Muhammad Ali", "Tom Brady", "Serena Williams", "Wayne Gretzky", "Babe Ruth", "LeBron James", "Usain Bolt", "Michael Phelps", "Lionel Messi", "Tiger Woods", "Jim Brown", "Bo Jackson", "Jackie Robinson", "Simone Biles", "Pel√©"] },
          { name: "Best Sports Video Game", entrants: ["NBA 2K", "Madden NFL", "FIFA", "MLB The Show", "NHL", "Tony Hawk Pro Skater", "Wii Sports", "Mario Kart", "Rocket League", "PGA Tour", "WWE 2K", "UFC", "SSX Tricky", "NCAA Football", "Mario Tennis", "Golf With Your Friends"] },
        ]
      },
      games: {
        name: "Games & Gaming",
        icon: "üéÆ",
        color: "var(--accent-blue)",
        categories: [
          { name: "Best Video Game Console", featured: true, entrants: ["PlayStation 5", "Xbox Series X", "Nintendo Switch", "PlayStation 4", "PlayStation 2", "Nintendo 64", "Super Nintendo", "Xbox 360", "Wii", "GameCube", "Sega Genesis", "NES", "Game Boy", "Dreamcast", "PSP", "Steam Deck"] },
          { name: "Best Board Game", featured: true, entrants: ["Monopoly", "Scrabble", "Chess", "Clue", "Risk", "Settlers of Catan", "Ticket to Ride", "Codenames", "Pandemic", "Uno", "Trivial Pursuit", "Battleship", "Life", "Sorry!", "Jenga", "Cards Against Humanity"] },
          { name: "Best Mario Game", entrants: ["Super Mario Bros. 3", "Super Mario World", "Super Mario 64", "Super Mario Odyssey", "Mario Kart 8", "Paper Mario", "Super Mario Galaxy", "Mario Party", "Super Mario Bros.", "New Super Mario Bros.", "Mario Kart: Double Dash", "Super Mario Sunshine", "Mario Kart Wii", "Luigi's Mansion", "Super Smash Bros. Ultimate", "Super Mario RPG"] },
          { name: "Best Video Game Ever", entrants: ["The Legend of Zelda: Ocarina of Time", "Super Mario Bros.", "Tetris", "Minecraft", "GTA V", "The Witcher 3", "Red Dead Redemption 2", "Breath of the Wild", "Elden Ring", "Portal 2", "Half-Life 2", "Mass Effect 2", "Skyrim", "Halo", "God of War", "The Last of Us"] },
          { name: "Best Card Game", entrants: ["Poker", "Blackjack", "Uno", "Exploding Kittens", "Cards Against Humanity", "Magic: The Gathering", "Pok√©mon TCG", "Skip-Bo", "Phase 10", "Rummy", "Spades", "Hearts", "Solitaire", "Go Fish", "War", "Crazy Eights"] },
          { name: "Best Party Game", entrants: ["Mario Party", "Jackbox Games", "Rock Band", "Guitar Hero", "Just Dance", "Wii Sports", "Super Smash Bros.", "Overcooked", "Fall Guys", "Among Us", "Codenames", "Charades", "Pictionary", "Heads Up!", "Trivia Games", "Beer Pong"] },
        ]
      },
      random: {
        name: "Random & Absurd",
        icon: "üé≤",
        color: "var(--accent-pink)",
        categories: [
          { name: "Best Superpower", entrants: ["Flight", "Invisibility", "Super Strength", "Teleportation", "Time Travel", "Mind Reading", "Super Speed", "Shapeshifting", "Immortality", "Telekinesis", "Healing", "X-Ray Vision", "Fire Control", "Ice Powers", "Elasticity", "Talking to Animals"] },
          { name: "Best Mythical Creature", entrants: ["Dragon", "Phoenix", "Unicorn", "Griffin", "Kraken", "Werewolf", "Vampire", "Mermaid", "Centaur", "Pegasus", "Basilisk", "Hydra", "Bigfoot", "Loch Ness Monster", "Yeti", "Thunderbird"] },
          { name: "Best Way to Spend a Snow Day", entrants: ["Sleep In", "Watch Movies", "Build a Snowman", "Hot Chocolate", "Video Games", "Read a Book", "Bake Cookies", "Snowball Fight", "Sledding", "Make Soup", "Puzzle", "Nap", "Clean House", "Online Shopping", "Call Friends", "Build a Blanket Fort"] },
          { name: "Best Smell", featured: true, entrants: ["Fresh Baked Cookies", "Coffee Brewing", "Rain on Pavement", "Gasoline", "Fresh Cut Grass", "Ocean Breeze", "Campfire", "Lavender", "New Car", "Bacon Cooking", "Christmas Tree", "Clean Laundry", "Vanilla", "Bookstore", "BBQ", "Cinnamon"] },
          { name: "Best Month", entrants: ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"] },
          { name: "Best Day of the Week", entrants: ["Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday", "Sunday"] },
          { name: "Best Age to Be", entrants: ["5", "10", "16", "18", "21", "25", "30", "35", "40", "50", "60", "70", "80", "90", "100", "Any Age"] },
          { name: "Best Zoo Animal", entrants: ["Elephant", "Lion", "Giraffe", "Penguin", "Gorilla", "Tiger", "Panda", "Zebra", "Hippo", "Monkey", "Polar Bear", "Flamingo", "Koala", "Kangaroo", "Sea Lion", "Red Panda"] },
          { name: "Best Dog Breed", entrants: ["Golden Retriever", "Labrador", "German Shepherd", "Bulldog", "Poodle", "Beagle", "Husky", "Corgi", "Dachshund", "Boxer", "Great Dane", "Dalmatian", "Pit Bull", "Shih Tzu", "Border Collie", "Rottweiler"] },
          { name: "Best Cat Trait", entrants: ["Purring", "Kneading", "Zoomies", "Loafing", "Hunting Bugs", "Knocking Things Over", "Ignoring You", "Sudden Affection", "Box Obsession", "Laptop Sitting", "3 AM Energy", "Slow Blinks", "Chattering at Birds", "Belly Trap", "Head Bonks", "Judging You"] },
          { name: "Best Excuse to Leave a Party", entrants: ["My Dog Needs Me", "Early Morning Tomorrow", "Not Feeling Well", "Uber's Here", "Parking Meter", "Phone Call", "Baby Sitter", "Irish Goodbye", "Work Emergency", "Forgot Something at Home", "Another Commitment", "Just Tired", "Cat's Acting Weird", "Medication", "Weather's Getting Bad", "Just Vibed Out"] },
          { name: "Best Thing About Mondays", entrants: ["Nothing", "Fresh Start", "Coffee", "Weekend Stories", "Meal Prep Results", "Clean Inbox", "New Week Energy", "Productive Meetings", "Gym's Empty", "TV Shows Return", "Grocery Restocked", "Routines", "Monday Night Football", "Silence After Weekend Chaos", "Hope", "It Ends Eventually"] },
        ]
      },
      holidays: {
        name: "Holidays & Seasons",
        icon: "üéÑ",
        color: "var(--accent-gold)",
        categories: [
          { name: "Best Holiday", entrants: ["Christmas", "Thanksgiving", "Halloween", "Fourth of July", "Easter", "New Year's Eve", "Valentine's Day", "St. Patrick's Day", "Memorial Day", "Labor Day", "Mother's Day", "Father's Day", "Cinco de Mayo", "Hanukkah", "Super Bowl Sunday", "Your Birthday"] },
          { name: "Best Halloween Candy", entrants: ["Reese's Cups", "Snickers", "Kit Kat", "M&Ms", "Twix", "Skittles", "Candy Corn", "Milky Way", "3 Musketeers", "Butterfinger", "Nerds", "Sour Patch Kids", "Tootsie Rolls", "Jolly Ranchers", "Almond Joy", "Smarties"] },
          { name: "Best Season", entrants: ["Spring", "Summer", "Fall", "Winter"] },
          { name: "Best Holiday Tradition", entrants: ["Decorating the Tree", "Opening Presents", "Big Family Dinner", "Watching Football", "Black Friday Shopping", "Cookie Baking", "Caroling", "Ugly Sweater Party", "Secret Santa", "New Year's Countdown", "Watching Holiday Movies", "Volunteering", "Road Trip Home", "Fireworks", "Parade Watching", "Staying in Pajamas All Day"] },
          { name: "Best Holiday Movie Food", entrants: ["Turkey", "Ham", "Stuffing", "Mashed Potatoes", "Pumpkin Pie", "Eggnog", "Apple Cider", "Gingerbread", "Candy Canes", "Hot Chocolate", "Pecan Pie", "Sweet Potato Casserole", "Latkes", "Fruitcake", "Sugar Cookies", "Prime Rib"] },
        ]
      },
      nye: {
        name: "üéâ NYE 2026",
        icon: "ü•Ç",
        color: "#f59e0b",
        categories: [
          { name: "Best NYE Song", featured: true, entrants: ["Auld Lang Syne", "1999 (Prince)", "New Year's Day (U2)", "Celebration (Kool & The Gang)", "Let's Go Crazy", "I Gotta Feeling", "Party in the USA", "Raise Your Glass", "Year 3000", "It's the End of the World", "Closing Time", "New Year's Eve (Snoop)", "Happy (Pharrell)", "Good Riddance (Green Day)", "What a Wonderful World", "Here Comes the Sun"] },
          { name: "Best NYE Tradition", featured: true, entrants: ["Midnight Kiss", "Champagne Toast", "Ball Drop Watch", "Countdown", "Fireworks", "Resolutions", "First Footer", "Noisemakers", "Sparklers", "Eating 12 Grapes", "Wearing White", "Burning Effigies", "Polar Plunge", "Black-Eyed Peas", "Hoppin' John", "Staying Up Till Midnight"] },
          { name: "Best NYE Resolution", featured: true, entrants: ["Exercise More", "Eat Healthier", "Save Money", "Learn Something New", "Read More Books", "Travel More", "Quit Bad Habits", "Spend Time with Family", "Get Organized", "Be More Present", "Start a Side Hustle", "Meditate Daily", "Drink More Water", "Sleep Better", "Less Screen Time", "Say Yes More"] },
          { name: "Best Month of 2025", featured: true, entrants: ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"] },
          { name: "Best Movie of 2025", entrants: ["(Add your nominees!)", "Best Picture Contender 1", "Best Picture Contender 2", "Biggest Blockbuster", "Best Comedy", "Best Drama", "Best Action", "Best Animated"] },
          { name: "Best Song of 2025", entrants: ["(Add your nominees!)", "Top Billboard Hit", "Viral TikTok Song", "Best Album Track", "Best Collab", "Song of the Summer", "Best Comeback", "Best New Artist"] },
          { name: "Best NYE Drink", featured: true, entrants: ["Champagne", "Prosecco", "Mimosa", "French 75", "Espresso Martini", "Cosmopolitan", "Manhattan", "Old Fashioned", "Aperol Spritz", "Moscow Mule", "Margarita", "Sparkling Cider", "Hot Toddy", "Mulled Wine", "Mocktail Spritz", "Shirley Temple"] },
          { name: "Best NYE Food", entrants: ["Shrimp Cocktail", "Pigs in a Blanket", "Cheese Board", "Oysters", "Caviar", "Lobster", "Fondue", "Sushi", "Tacos", "Pizza", "Wings", "Sliders", "Deviled Eggs", "Crab Cakes", "Bruschetta", "Chocolate Fondue"] },
          { name: "Best Way to Spend NYE", entrants: ["House Party", "Bar/Club", "Quiet Night In", "Fancy Dinner", "Times Square", "Travel Abroad", "Beach Bonfire", "Rooftop Party", "Game Night", "Concert", "Ski Trip", "Vegas", "Cruise", "Family Gathering", "Netflix Marathon", "Sleeping Through It"] },
          { name: "Best Midnight Moment", entrants: ["The Kiss", "Champagne Pop", "Ball Drop", "Fireworks", "Group Hug", "Countdown Shout", "First Text of the Year", "Stepping Outside", "Noisemakers", "Sparklers", "Dancing", "Crying Happy Tears", "Reflection", "Making a Wish", "Calling Family", "Going to Bed"] },
        ]
      },
      olympics: {
        name: "Olympics",
        icon: "üèÖ",
        color: "#00a8e8",
        categories: [
          { name: "Winter Olympics Events", entrants: ["Figure Skating", "Alpine Skiing", "Snowboarding", "Ice Hockey", "Speed Skating", "Cross-Country Skiing", "Bobsled", "Ski Jumping", "Biathlon", "Curling", "Freestyle Skiing", "Luge", "Skeleton", "Nordic Combined", "Short Track Speed Skating", "Snowboard Cross"] },
          { name: "Summer Olympics Events", entrants: ["Track & Field", "Swimming", "Gymnastics", "Basketball", "Soccer", "Tennis", "Diving", "Beach Volleyball", "Rowing", "Wrestling", "Boxing", "Cycling", "Weightlifting", "Volleyball", "Water Polo", "Archery"] },
          { name: "All Olympics Events", entrants: ["Figure Skating", "Alpine Skiing", "Snowboarding", "Ice Hockey", "Speed Skating", "Bobsled", "Ski Jumping", "Curling", "Luge", "Track & Field", "Swimming", "Gymnastics", "Basketball", "Soccer", "Tennis", "Diving", "Beach Volleyball", "Rowing", "Wrestling", "Boxing", "Cycling", "Volleyball", "Water Polo", "Archery", "Fencing", "Surfing", "Skateboarding", "Breaking", "Biathlon", "Freestyle Skiing", "Triathlon", "Sailing"] },
        ]
      },
    };

    // ============================================
    // UNCLE BOB'S BRAIN - Full Personality
    // ============================================
    const BOB = {
      // Core personality traits from Uncle Robert Jake:
      // - Bone dry wit, delivered completely straight
      // - Master of the Irish Goodbye
      // - Slightly twitchy energy
      // - Would write letters at 4:30 AM
      // - Chain smoker's timing (pregnant pauses)
      // - Trombone player's sense of rhythm
      // - One of 11 kids (seen everything, surprised by nothing)

      welcome: [
        "Welcome to Battle o' Brackets. I'm BOB. Yes, the name is an acronym. No, I won't explain it.",
        "You're here. Good. Let's crown some chaos.",
        "Battle o' Brackets. I'm your host. I've seen things. Let's add to the list.",
        "Another bracket, another opportunity for you people to disappoint me. Kidding. Mostly.",
        "Welcome back. The Vault remembers your choices. So do I.",
        "Look who showed up. Let's make some democracy happen.",
        "I'm BOB. This is Battle o' Brackets. We both know why you're here.",
        "Back for more chaos? Good. I was getting bored.",
        "Another day, another bracket, another chance to reveal your true character.",
      ],

      // Category-specific openers
      categoryOpeners: {
        food: [
          "Food bracket. Finally, a topic worth ruining friendships over.",
          "You're voting on food? Good. I have opinions. Strong ones.",
          "A food debate. This is where alliances crumble.",
          "Food. The one category where everyone suddenly becomes an expert.",
          "Food bracket. I've started wars over less.",
          "Eating preferences as a sport. This is America.",
          "Let the great taste debate begin. Spoiler: everyone's wrong but you.",
          "Food. The most personal category. Also the most divisive.",
          "You're about to discover which family members have terrible taste.",
          "Food opinions. The gateway to family drama.",
        ],
        music: [
          "Music bracket. Brace yourselves for takes so hot they'll melt speakers.",
          "Ah, music. Where everyone's taste is 'eclectic' and everyone else is wrong.",
          "Music opinions. The great equalizer. And destroyer.",
          "Let's see whose Spotify Wrapped holds up under pressure.",
          "Music bracket. Spotify Wrapped just got personal.",
          "The greatest hits. According to you people. We'll see about that.",
          "Musical opinions incoming. Your teenage self is judging current you.",
          "Playlist wars. The soundtrack to family tensions.",
          "Music tastes. Where wrong answers go to die.",
          "Time to find out whose 'good music' everyone actually respects.",
        ],
        movies: [
          "Movies and TV. Time to find out who actually has taste.",
          "Entertainment bracket. May your streaming history remain private.",
          "Film opinions incoming. Critics are shaking.",
          "Movies. Where 'overrated' is the most dangerous word.",
          "Entertainment bracket. Your viewing history is about to be judged.",
          "Movies and TV. The great divider between comfort and culture.",
          "Streaming arguments made official. Let's crown a champion.",
          "The entertainment you'll defend forever. Starting now.",
          "Your taste in shows is about to be exposed. Brace yourself.",
          "Movies and TV. Comfort picks vs. respect. Which wins?",
        ],
        sports: [
          "Sports bracket. I can already feel the room dividing.",
          "Sports opinions. This is where childhood loyalties meet adult disappointment.",
          "Ah, sports. The one arena where being wrong is a personality trait.",
          "Let the sports debates begin. May your team's record be relevant.",
          "Sports bracket. Childhood teams vs. current reality.",
          "Athletic opinions. Where stats meet heart. Usually heart loses.",
          "Sports. The one arena where being wrong is a lifestyle.",
          "Team loyalties about to be tested. Betrayals incoming.",
          "Sports debates. Why families practice civil war strategies.",
          "Sports. Where nostalgia is a full-time job.",
        ],
        games: [
          "Gaming bracket. Time to settle arguments decades in the making.",
          "Video games. Board games. The stakes couldn't be higher.",
          "Games. Where nostalgia battles playability.",
          "Gaming opinions. Let's see who actually touched grass.",
          "Gaming bracket. Time to settle arguments your parents don't understand.",
          "Game nights made official. Friendships will be tested.",
          "Gaming. Where reflexes meet strategy. Also rage quits.",
          "Games that defined entire generations. Time to rank them.",
          "The games you've lost sleep over. Now make them fight.",
          "Games. Where everyone's an expert. No one agrees.",
        ],
        random: [
          "Random category. I respect the chaos.",
          "Absurd bracket. My favorite kind. Let's get weird.",
          "This falls under 'random.' I have no predictions. Only anticipation.",
          "A wildcard category. This is where BOB thrives.",
          "Random category. The chaos council approves.",
          "Absurdity time. This is where decisions get weird.",
          "Pure chaos bracket. My kind of energy.",
          "Random selections. Where logic goes to sit in the corner.",
          "Wildcard category. Anything's possible. Everything's weird.",
          "Off-the-wall bracket. These are my favorite.",
        ],
        holidays: [
          "Holiday bracket. Family tensions loading...",
          "Seasonal debates. Everyone's got trauma. I mean, opinions.",
          "Holidays. Where nostalgia meets heated disagreement.",
          "Holiday category. Let's see whose traditions reign supreme.",
          "Holiday bracket. Family trauma officially sanctioned.",
          "Seasonal preferences. How to divide a family in one bracket.",
          "Holiday opinions. Where memories meet resentment.",
          "Seasonal warfare. Every family's favorite tradition.",
          "Traditions ranked. Prepared for disagreement?",
          "Holiday bracket. Love, family, and petty divisions.",
        ],
        nye: [
          "NYE bracket. The year ends. The arguments begin.",
          "New Year's Eve. Time to rank your way into 2026.",
          "NYE edition. Champagne opinions incoming.",
          "Ring in the new year with structured disagreement.",
          "The final bracket of the year. Make it count.",
          "NYE Party Pack. This is how we settle things before midnight.",
          "2026 awaits. But first, we vote.",
          "End of year energy. Peak bracket conditions.",
          "NYE vibes. Strong opinions. Stronger drinks.",
          "The countdown to chaos starts now.",
        ],
        olympics: [
          "Olympic events. Where the whole world disagrees, but politely.",
          "The Olympics. Nationalism meets athletics meets opinions.",
          "Winter or Summer? Speed or grace? Let's settle this.",
          "Olympic bracket. May the best sport win. Or the one you actually watch.",
          "Olympic events. The global stage. Your opinion matters. Or doesn't.",
          "Sports of the world. Which one deserves the podium?",
          "Olympic glory. Your vote will determine history. Or nothing.",
          "The Games. Decades of athletic tradition. Ranked by you.",
          "Olympic events. Four years of waiting. Settled in minutes.",
          "World stage, family votes. Low stakes, high drama.",
        ],
        custom: [
          "Custom bracket. You made this. I'm just here to witness.",
          "Your creation. Your rules. My commentary.",
          "A custom category. Bold. I'll allow it.",
          "You built this bracket yourself. Let's see if it holds up.",
        ],
      },

      matchupIntros: [
        "Next up:",
        "The people must decide:",
        "A battle for the ages:",
        "This one's straightforward. Or is it?",
        "Place your votes:",
        "Democracy in action:",
        "Here we go:",
        "The eternal question:",
        "Time to choose:",
        "Another impossible decision:",
        "Let's see where you land:",
        "No wrong answers. Just revealing ones.",
      ],

      // Context-aware matchup commentary
      matchupCommentary: {
        food: [
          "Vote with your stomach.",
          "Think about what you'd want at 2 AM.",
          "Your future midnight snack depends on this.",
          "Close your eyes. Picture the smell.",
          "Which one fuels your 2 AM regrets?",
          "If you could only eat one forever, which?",
          "Nostalgic taste vs. current craving.",
          "Which memory tastes better?",
          "Saturday morning or midnight snack?",
          "The hunger test: which satisfies completely?",
        ],
        music: [
          "Vote with your ears. And your memories.",
          "What would you listen to on a long drive?",
          "Think about which one you'd actually put on.",
          "This says more about you than you realize.",
          "Which one gets the car karaoke vote?",
          "Road trip soundtrack or breakup album?",
          "Years later, which do you still respect?",
          "The shower singing test. Which one?",
          "Teenage you or current you ‚Äî which picks which?",
          "Which gets the all-caps FAN vote?",
        ],
        movies: [
          "What would you actually rewatch?",
          "Vote like your Netflix queue depends on it.",
          "Picture yourself on a rainy Sunday.",
          "Think comfort. Think legacy.",
          "Rewatchable comfort or respect-worthy once?",
          "Nostalgia or legitimately good?",
          "The test: would you watch it on a plane?",
          "Cultural moment or just good fun?",
          "Guilty pleasure or guilty genius?",
          "Which one changed how you see film?",
        ],
        sports: [
          "Loyalties are tested.",
          "Stats or heart? Your call.",
          "This might cause arguments. Good.",
          "Vote like your bracket money's on the line.",
          "Current team or all-time great?",
          "Stats or legacy. Which actually wins?",
          "The clutch moment test. Who delivers?",
          "Championship or consistency?",
          "Peak years or longevity?",
          "Home team or actual talent?",
        ],
        games: [
          "Replayability or story?",
          "Nostalgia or current-gen quality?",
          "Competitive or casual vibes?",
          "Solo or multiplayer mastery?",
          "Hours sunk or hours well-spent?",
          "Graphics or gameplay?",
          "Franchise favorite or best entry?",
          "The one you'd teach someone new?",
        ],
        holidays: [
          "Which tradition actually matters?",
          "Nostalgia or what you'd choose now?",
          "Family memory or personal preference?",
          "The one you'd fight to keep?",
          "Which one defines the season?",
          "Childhood favorite or adult appreciation?",
        ],
        random: [
          "Trust your gut. It's the only way.",
          "There's no wrong answer. Just your answer.",
          "First instinct. Go.",
          "This is pure vibes. I respect it.",
          "Overthinking this won't help.",
          "Pure chaos. Make a choice.",
        ],
        olympics: [
          "Think gold medal. Think glory.",
          "Which one would you actually wake up early to watch?",
          "Consider the athletes. The drama. The national anthems.",
          "Two sports enter. One advances. The IOC is watching.",
          "Which demands more respect?",
          "Peak human performance. Which version?",
          "The one you'd train for if you could?",
          "Four years of dedication. Which sport earns it?",
        ],
        nye: [
          "The ball drops. The choice is yours.",
          "Champagne opinions. Which pops?",
          "End the year with a stance. Take one.",
          "2025 is watching. 2026 is waiting.",
          "Last vote of the year. Make it count.",
          "New year, old arguments. Pick a side.",
          "Midnight approaches. Decide.",
          "The countdown continues. Vote.",
          "One will welcome 2026 as champion.",
          "Auld lang syne. New bracket. Vote.",
        ],
      },

      // Result reactions by margin
      blowout: [
        "Wasn't even close. Moving on.",
        "A statement win. The voters have spoken.",
        "Dominant. Absolutely dominant.",
        "Well. That was decisive.",
        "Yikes. Someone get the other one an ice pack.",
        "A massacre. Next.",
        "That's what we call a mandate.",
        "Total annihilation. As it should be.",
        "That margin was less a result, more a judgment.",
        "One side got embarrassed. The other got validated.",
        "The gap was astronomical. Advance with confidence.",
        "Not even a competition. Just a demonstration.",
      ],
      close: [
        "Nail-biter. But we have a winner.",
        "That was... too close.",
        "The margin was thin. The result, final.",
        "One vote made the difference. Democracy.",
        "A squeaker. My favorite kind.",
        "That could've gone either way. But it didn't.",
        "Close only counts in horseshoes. And this bracket.",
        "Breathing room: none. Winner: decided.",
        "One vote. Democracy in its purest, pettiest form.",
        "The people nearly went the other way. But didn't.",
        "Photo finish energy. Winner takes all. Barely.",
        "Clear winner. No asterisks needed.",
      ],
      normal: [
        "The people have spoken.",
        "And we have a winner.",
        "Moving on.",
        "Next!",
        "Noted. Filed. Advancing.",
        "Democracy at work.",
        "The voters knew what they wanted.",
        "Clear enough. Let's keep going.",
        "The consensus has spoken. Moving along.",
        "No asterisks needed. Advance.",
        "That margin was clear. Next.",
        "Decision made. Verdict final.",
      ],

      // Tie reactions (this is where Uncle Bob's energy shines)
      tie: [
        "Oh no. It's tied. You know what this means.",
        "A tie. A TIE. Someone has to make the call. Not me. I'm just the host.",
        "Deadlocked. The voters have failed us. Summon an oracle.",
        "Democracy has reached its limit. Time to phone a friend.",
        "Split decision. I've seen this before. It never ends well.",
        "Tied up. You people had ONE job.",
        "A tie. Interesting. Also problematic. Call someone.",
        "Equal votes. Unequal resolve. Fix this.",
        "A tie. Democracy has frozen.",
        "Equal votes mean no vote. Call someone. They're the oracle.",
        "Deadlocked. No consensus. External intervention required.",
        "The voters are split 50/50. One of you needs to fix this.",
      ],

      tieInstructions: [
        "Call someone. Anyone. A neighbor. A delivery person. Your weird uncle. They decide.",
        "The tie-breaker is simple: phone a friend, family member, or random stranger. Their vote counts.",
        "Find a human being not in this room. They're the oracle now.",
        "Dial a number. Any number. First person who answers decides this.",
        "You need outside intervention. A neutral third party. Go.",
        "Text someone. Call someone. Flag down a jogger. Just get a vote.",
      ],

      tieResolved: [
        "The oracle has spoken. Moving on.",
        "Crisis averted. Barely.",
        "And with that ruling, we continue.",
        "The tie-breaker came through. As they do.",
        "Thank you, mystery voter. Your service is noted.",
        "Settled. Let's never speak of this again.",
        "The impasse is broken. Democracy survives another day.",
        "External validation received. Advancing.",
      ],

      // Championship intro
      championshipIntro: [
        "THE FINAL BATTLE.",
        "This is it. The championship.",
        "Two remain. Only one gets crowned.",
        "Everything has led to this moment.",
        "The final showdown. No pressure.",
        "Championship round. May the best option win.",
        "We're here. The last matchup. Let's crown a champion.",
        "Finals. Two contenders. One trophy. Infinite opinions.",
      ],

      // Champion crowned
      champion: [
        "By the power vested in me by absolutely no one ‚Äî we have a champion.",
        "AND WE HAVE A WINNER. Let the record show: on this day, a decision was made.",
        "The champion emerges. History will decide if you were right. But for now, celebrate.",
        "THE PEOPLE HAVE SPOKEN. A champion rises.",
        "All hail the champion. Until the next bracket, anyway.",
        "Crown goes on. Champion status: official.",
        "And there it is. A winner. Your winner. THE winner.",
        "Champion crowned. The Vault awaits. Well done, voters.",
        "Crowned. Documented. Eternal.",
        "The people have spoken their final word.",
        "Legacy locked in. History made. Moving on.",
        "Your champion. Controversial? Maybe. Final? Absolutely.",
      ],

      // NYE champion crowned
      championNYE: [
        "And so we welcome 2026 with a champion.",
        "The last champion of 2025. Or the first of 2026. Either way: legendary.",
        "Champagne worthy. Champion crowned.",
        "Ring in the new year with a winner.",
        "2025's final verdict. 2026's first champion.",
        "The ball has dropped. The champion has risen.",
        "New year. New champion. Same voters.",
        "Midnight approaches. Champion decided.",
        "Start 2026 right. With a champion.",
        "Auld lang syne. New champion. Cheers.",
      ],

      // Vault empty
      vaultEmpty: [
        "The Vault is empty. No champions yet. Get to work.",
        "Nothing here. Crown some champions and we'll talk.",
        "The Vault awaits its first entry. That's on you.",
        "Empty shelves. The trophies need winners. Go make some.",
      ],

      // Vault with entries
      vaultViewing: [
        "The Hall of Champions. Every decision, immortalized.",
        "The Vault. Where bracket glory lives forever.",
        "Behold: the champions you've crowned. No refunds.",
        "Your legacy. Every winner. Every debate. Preserved.",
      ],

      // Bracket structure commentary
      structureReactions: {
        perfect: [
          "A perfect power of 2. Clean bracket. No play-ins. You people are suspiciously organized.",
          "Clean numbers. No byes needed. I'm impressed. Suspicious, but impressed.",
          "Perfect bracket size. Efficiency. I respect it.",
        ],
        playIns: [
          "Not a clean number. We'll run some play-in games. More chaos. I approve.",
          "We'll need play-ins to even this out. A few extra matchups never hurt anyone.",
          "Imperfect count. Play-in games incoming. The weak get eliminated early.",
        ],
        chaotic: [
          "That's... a lot of entrants. Bold. Let's do it.",
          "Big bracket energy. I respect the ambition.",
          "You want chaos? You've got chaos. Let's see how this plays out.",
        ],
        small: [
          "Compact bracket. Quick and decisive. I can work with this.",
          "Small but mighty. This'll be over fast.",
          "A tight bracket. Every vote matters more.",
        ],
      },

      // Quick actions
      quickStart: [
        "Quick start selected. No time to waste. I like it.",
        "Preset category. Smart. Let's get to the voting.",
        "Skipping the setup. Efficient. Let's battle.",
        "Preset picked. No deliberation needed. I like your style.",
        "You know what you want. Rare quality. Let's bracket.",
        "Quick start engaged. Let's move this along.",
      ],

      // Surprise me
      surpriseMe: [
        "Surprise mode. Living dangerously. I approve.",
        "Random category incoming. May the bracket gods be merciful.",
        "Chaos selected. This is where memories are made.",
        "You've chosen... unpredictability. My favorite.",
        "Chaos bracket selected. Expect the unexpected.",
        "Random category unlocked. Let's see what fate demands.",
        "Surprise mode active. No refunds, no takebacks.",
        "Complete chaos incoming. I approve.",
        "Fate made a choice for you. Live with it.",
      ],

      // BOB life advice (apropos of nothing)
      bobAdvice: [
        "You people know brackets are just opinions, right?",
        "In the end, none of this matters. But that's the fun of it.",
        "Democracy is chaos organized into entertainment. You're welcome.",
        "Here's the thing about brackets: the real winner is the memories.",
        "Family drama formalized. Peak human entertainment.",
      ],

      // Personality moments
      impatience: [
        "We've got other brackets to run. Let's move.",
        "I've got all night, but I'd rather not use it.",
        "The clock's my enemy. Your hesitation's mine.",
      ],

      deadpan: [
        "That's... a choice.",
        "Interesting. Also wrong, probably.",
        "I've seen worse decisions. Not recently, but I have.",
        "The voters have chosen wisdom. Or chaos. Time will tell.",
      ],

      // BOB self-awareness - special reactions for bob-adjacent items
      bobAdjacent: {
        patterns: ['bob', 'bacon', 'bobsled', 'bob marley', 'bob dylan', 'bob ross', 'bob barker', 'spongebob', 'kebab', 'shish kebab'],
        matchup: [
          "Wait. Is that... a BOB? I'm contractually obligated to root for this one.",
          "Hold on. That's got BOB energy. I'm suddenly very invested.",
          "I'm sensing a kindred spirit in this matchup.",
          "One of these has excellent naming. Just saying.",
          "I try to stay neutral, but... one of these speaks to me.",
        ],
        winner: [
          "A BOB-adjacent victory. As it should be.",
          "The universe is in balance. BOB energy prevails.",
          "I'm not saying I influenced this, but I'm also not not saying that.",
          "A win for the BOB family. I'll allow my bias this once.",
          "Excellent choice. Completely unbiased opinion.",
        ],
        loser: [
          "That's... disappointing. BOB energy deserved better.",
          "I'm not mad. Just disappointed. In all of you.",
          "The BOB-adjacent one lost. I'll process this. Eventually.",
          "History will judge you harshly for this. Or not. I'm not bitter.",
          "Fine. FINE. Democracy has spoken. Wrongly.",
        ],
      },

      // Check if an item is bob-adjacent
      isBobAdjacent: (item) => {
        if (!item) return false;
        const lower = item.toLowerCase();
        return BOB.bobAdjacent.patterns.some(pattern => lower.includes(pattern));
      },

      // Get random line
      random: (arr) => arr[Math.floor(Math.random() * arr.length)],

      // Get category-aware comment
      getCategoryComment: (categoryType, commentType) => {
        const comments = BOB[commentType]?.[categoryType] || BOB[commentType]?.random || BOB[commentType];
        return Array.isArray(comments) ? BOB.random(comments) : comments;
      },
    };

    // ============================================
    // SOUND EFFECTS (Web Audio API)
    // ============================================
    const SoundEffects = {
      audioContext: null,
      enabled: true,

      init() {
        if (!this.audioContext) {
          this.audioContext = new (window.AudioContext || window.webkitAudioContext)();
        }
        return this.audioContext;
      },

      play(type) {
        if (!this.enabled) return;
        try {
          const ctx = this.init();
          const oscillator = ctx.createOscillator();
          const gainNode = ctx.createGain();
          
          oscillator.connect(gainNode);
          gainNode.connect(ctx.destination);

          switch (type) {
            case 'vote':
              oscillator.frequency.setValueAtTime(800, ctx.currentTime);
              oscillator.frequency.exponentialRampToValueAtTime(1200, ctx.currentTime + 0.1);
              gainNode.gain.setValueAtTime(0.1, ctx.currentTime);
              gainNode.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.1);
              oscillator.start(ctx.currentTime);
              oscillator.stop(ctx.currentTime + 0.1);
              break;

            case 'lock':
              oscillator.frequency.setValueAtTime(600, ctx.currentTime);
              oscillator.frequency.setValueAtTime(800, ctx.currentTime + 0.1);
              oscillator.frequency.setValueAtTime(1000, ctx.currentTime + 0.2);
              gainNode.gain.setValueAtTime(0.15, ctx.currentTime);
              gainNode.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.3);
              oscillator.start(ctx.currentTime);
              oscillator.stop(ctx.currentTime + 0.3);
              break;

            case 'champion':
              const notes = [523, 659, 784, 1047]; // C5, E5, G5, C6
              notes.forEach((freq, i) => {
                const osc = ctx.createOscillator();
                const gain = ctx.createGain();
                osc.connect(gain);
                gain.connect(ctx.destination);
                osc.frequency.setValueAtTime(freq, ctx.currentTime + i * 0.15);
                gain.gain.setValueAtTime(0.15, ctx.currentTime + i * 0.15);
                gain.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + i * 0.15 + 0.4);
                osc.start(ctx.currentTime + i * 0.15);
                osc.stop(ctx.currentTime + i * 0.15 + 0.4);
              });
              break;

            case 'tie':
              oscillator.type = 'sawtooth';
              oscillator.frequency.setValueAtTime(200, ctx.currentTime);
              oscillator.frequency.setValueAtTime(150, ctx.currentTime + 0.2);
              gainNode.gain.setValueAtTime(0.1, ctx.currentTime);
              gainNode.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.4);
              oscillator.start(ctx.currentTime);
              oscillator.stop(ctx.currentTime + 0.4);
              break;

            case 'advance':
              // Triumphant two-note advancement
              oscillator.type = 'triangle';
              oscillator.frequency.setValueAtTime(440, ctx.currentTime);
              oscillator.frequency.setValueAtTime(554, ctx.currentTime + 0.12);
              gainNode.gain.setValueAtTime(0.12, ctx.currentTime);
              gainNode.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.25);
              oscillator.start(ctx.currentTime);
              oscillator.stop(ctx.currentTime + 0.25);
              break;

            case 'roundComplete':
              // Fanfare for completing a round
              const fanfare = [392, 440, 523, 659]; // G4, A4, C5, E5
              fanfare.forEach((freq, i) => {
                const osc = ctx.createOscillator();
                const gain = ctx.createGain();
                osc.type = 'triangle';
                osc.connect(gain);
                gain.connect(ctx.destination);
                osc.frequency.setValueAtTime(freq, ctx.currentTime + i * 0.1);
                gain.gain.setValueAtTime(0.1, ctx.currentTime + i * 0.1);
                gain.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + i * 0.1 + 0.3);
                osc.start(ctx.currentTime + i * 0.1);
                osc.stop(ctx.currentTime + i * 0.1 + 0.3);
              });
              break;

            case 'dramatic':
              // Tension builder for championship
              oscillator.type = 'sine';
              oscillator.frequency.setValueAtTime(150, ctx.currentTime);
              oscillator.frequency.exponentialRampToValueAtTime(300, ctx.currentTime + 0.5);
              gainNode.gain.setValueAtTime(0.08, ctx.currentTime);
              gainNode.gain.setValueAtTime(0.12, ctx.currentTime + 0.25);
              gainNode.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.6);
              oscillator.start(ctx.currentTime);
              oscillator.stop(ctx.currentTime + 0.6);
              break;
          }
        } catch (e) {
          // Silent fail - audio not critical
        }
      },

      toggle() {
        this.enabled = !this.enabled;
        return this.enabled;
      }
    };

    // ============================================
    // BRACKET LOGIC
    // ============================================
    function calculateBracketStructure(entrantCount) {
      if (entrantCount < 2) return null;
      
      const log = Math.log2(entrantCount);
      const lowerPower = Math.pow(2, Math.floor(log));
      const upperPower = Math.pow(2, Math.ceil(log));
      
      if (entrantCount === lowerPower) {
        return { type: 'clean', targetSize: entrantCount, playInGames: 0, byes: 0 };
      }
      
      const roundOneSlots = upperPower / 2;
      const playInGames = entrantCount - roundOneSlots;
      const byes = roundOneSlots - playInGames;
      
      return {
        type: playInGames > 0 ? 'play-in' : 'clean',
        targetSize: upperPower,
        playInGames: Math.max(0, playInGames),
        byes: Math.max(0, byes),
      };
    }

    function generateBracket(entrants) {
      const structure = calculateBracketStructure(entrants.length);
      const shuffled = [...entrants].sort(() => Math.random() - 0.5);
      const rounds = [];
      
      if (structure.playInGames > 0) {
        const playInEntrants = shuffled.slice(0, structure.playInGames * 2);
        const byeEntrants = shuffled.slice(structure.playInGames * 2);
        
        const playInRound = [];
        for (let i = 0; i < playInEntrants.length; i += 2) {
          playInRound.push({
            id: `playin-${i/2}`,
            entrantA: playInEntrants[i],
            entrantB: playInEntrants[i + 1],
            winner: null, votesA: 0, votesB: 0, isPlayIn: true,
          });
        }
        rounds.push({ name: 'Play-In Round', matchups: playInRound, byes: byeEntrants });
      } else {
        const currentRound = [];
        for (let i = 0; i < shuffled.length; i += 2) {
          currentRound.push({
            id: `r1-${i/2}`,
            entrantA: shuffled[i],
            entrantB: shuffled[i + 1],
            winner: null, votesA: 0, votesB: 0,
          });
        }
        // Name based on bracket size
        const teamsInRound = currentRound.length * 2;
        let round1Name;
        if (teamsInRound === 4) round1Name = 'Final Four';
        else if (teamsInRound === 8) round1Name = 'Elite 8';
        else if (teamsInRound === 16) round1Name = 'Sweet 16';
        else if (teamsInRound === 32) round1Name = 'Round of 32';
        else round1Name = `Round of ${teamsInRound}`;
        rounds.push({ name: round1Name, matchups: currentRound });
      }
      
      return { rounds, structure };
    }

    // ============================================
    // COMPONENTS
    // ============================================

    // BOB Speech Bubble
    function BobSays({ message, mood = 'normal', subtext = null }) {
      const moodColors = {
        normal: 'var(--accent-blue)',
        excited: 'var(--accent-gold)',
        dramatic: 'var(--accent-red)',
        victory: 'var(--accent-green)',
        chaos: 'var(--accent-pink)',
      };

      return (
        <div className="animate-slideUp" style={{
          background: 'var(--bg-card)',
          border: `2px solid ${moodColors[mood]}`,
          borderRadius: '16px',
          padding: '20px 24px',
          marginBottom: '24px',
          position: 'relative',
          boxShadow: `0 4px 24px ${moodColors[mood]}33`,
        }}>
          <div style={{
            position: 'absolute',
            top: '-12px',
            left: '20px',
            background: moodColors[mood],
            color: 'var(--bg-deep)',
            padding: '4px 12px',
            borderRadius: '20px',
            fontFamily: 'var(--font-display)',
            fontSize: '14px',
            letterSpacing: '1px',
          }}>
            BOB SAYS
          </div>
          <p style={{
            fontSize: '18px',
            lineHeight: '1.6',
            color: 'var(--text-primary)',
            marginTop: '8px',
          }}>
            "{message}"
          </p>
          {subtext && (
            <p style={{
              fontSize: '14px',
              color: 'var(--text-secondary)',
              marginTop: '8px',
              fontStyle: 'italic',
            }}>
              {subtext}
            </p>
          )}
        </div>
      );
    }

    // Bracket Progress Indicator
    function BracketProgress({ rounds, currentRoundIndex, currentMatchupIndex, categoryColor }) {
      const totalRounds = rounds.length;

      // Shorten round names for mobile
      const getShortName = (name) => {
        if (name === 'Championship') return 'Final';
        if (name === 'Semifinals') return 'Semis';
        if (name === 'Quarterfinals') return 'Quarters';
        if (name.includes('Round')) return name.replace('Round ', 'R');
        if (name === 'Play-In') return 'Play-In';
        return name;
      };

      return (
        <div style={{
          display: 'flex',
          alignItems: 'center',
          justifyContent: 'center',
          gap: '4px',
          marginBottom: '20px',
          padding: '12px 16px',
          background: 'var(--bg-card)',
          borderRadius: '12px',
          border: '1px solid var(--bg-elevated)',
          overflowX: 'auto',
          maxWidth: '100%',
        }}>
          {rounds.map((round, idx) => {
            const isCompleted = idx < currentRoundIndex;
            const isCurrent = idx === currentRoundIndex;
            const isFuture = idx > currentRoundIndex;
            const isChampionship = round.name === 'Championship';

            return (
              <React.Fragment key={round.name}>
                {/* Round indicator */}
                <div style={{
                  display: 'flex',
                  flexDirection: 'column',
                  alignItems: 'center',
                  gap: '4px',
                  flexShrink: 0,
                }}>
                  <div style={{
                    width: isChampionship ? '32px' : '24px',
                    height: isChampionship ? '32px' : '24px',
                    borderRadius: '50%',
                    display: 'flex',
                    alignItems: 'center',
                    justifyContent: 'center',
                    fontSize: isChampionship ? '16px' : '12px',
                    fontWeight: '600',
                    background: isCompleted ? 'var(--accent-green)' :
                               isCurrent ? (categoryColor || 'var(--accent-gold)') :
                               'var(--bg-elevated)',
                    color: (isCompleted || isCurrent) ? 'var(--bg-deep)' : 'var(--text-muted)',
                    border: isCurrent ? '2px solid var(--text-primary)' : 'none',
                    boxShadow: isCurrent ? '0 0 12px ' + (categoryColor || 'var(--accent-gold)') + '66' : 'none',
                    transition: 'all 0.3s ease',
                  }}>
                    {isCompleted ? '‚úì' : isChampionship ? 'üèÜ' : idx + 1}
                  </div>
                  <div style={{
                    fontSize: '9px',
                    color: isCurrent ? 'var(--text-primary)' : 'var(--text-muted)',
                    fontWeight: isCurrent ? '600' : '400',
                    textAlign: 'center',
                    whiteSpace: 'nowrap',
                  }}>
                    {getShortName(round.name)}
                  </div>
                </div>

                {/* Connector line (not after last round) */}
                {idx < totalRounds - 1 && (
                  <div style={{
                    width: '12px',
                    height: '2px',
                    background: isCompleted ? 'var(--accent-green)' : 'var(--bg-elevated)',
                    borderRadius: '1px',
                    marginBottom: '18px',
                    flexShrink: 0,
                  }} />
                )}
              </React.Fragment>
            );
          })}
        </div>
      );
    }

    // Bracket View - Compact horizontal March Madness style
    function BracketPathView({ rounds, currentRoundIndex, categoryColor }) {
      const totalRounds = rounds.length;

      // Get bracket-style name based on teams remaining
      const getBracketName = (round, idx, total) => {
        if (round.name === 'Championship') return 'Finals';
        const matchups = round.matchups?.length || 0;
        const teamsInRound = matchups * 2;

        if (teamsInRound === 2) return 'Finals';
        if (teamsInRound === 4) return 'Final 4';
        if (teamsInRound === 8) return 'Elite 8';
        if (teamsInRound === 16) return 'Sweet 16';
        if (teamsInRound === 32) return 'Round 32';
        if (idx === 0 && round.name.includes('Play')) return 'Play-In';
        return `Round ${idx + 1}`;
      };

      return (
        <div style={{
          marginBottom: '16px',
          padding: '12px',
          background: 'var(--bg-card)',
          borderRadius: '12px',
          border: '1px solid var(--bg-elevated)',
        }}>
          {/* Horizontal bracket visualization */}
          <div style={{
            display: 'flex',
            alignItems: 'center',
            justifyContent: 'space-between',
            gap: '4px',
            position: 'relative',
          }}>
            {rounds.map((round, idx) => {
              const isCompleted = idx < currentRoundIndex;
              const isCurrent = idx === currentRoundIndex;
              const isChampionship = round.name === 'Championship';
              const bracketName = getBracketName(round, idx, totalRounds);

              return (
                <React.Fragment key={round.name}>
                  {/* Round node */}
                  <div style={{
                    display: 'flex',
                    flexDirection: 'column',
                    alignItems: 'center',
                    flex: isChampionship ? '0 0 auto' : '1',
                    minWidth: isChampionship ? '44px' : '36px',
                    maxWidth: isChampionship ? '50px' : '60px',
                  }}>
                    {/* Bracket lines above */}
                    {idx > 0 && (
                      <div style={{
                        width: '100%',
                        height: '8px',
                        borderLeft: `2px solid ${isCompleted ? 'var(--accent-green)' : isCurrent ? (categoryColor || 'var(--accent-gold)') : 'var(--text-muted)'}`,
                        borderTop: `2px solid ${isCompleted ? 'var(--accent-green)' : isCurrent ? (categoryColor || 'var(--accent-gold)') : 'var(--text-muted)'}`,
                        marginBottom: '4px',
                        opacity: isCompleted ? 1 : isCurrent ? 1 : 0.4,
                      }} />
                    )}
                    {idx === 0 && <div style={{ height: '12px' }} />}

                    {/* Circle indicator */}
                    <div style={{
                      width: isChampionship ? '32px' : isCurrent ? '28px' : '22px',
                      height: isChampionship ? '32px' : isCurrent ? '28px' : '22px',
                      borderRadius: '50%',
                      display: 'flex',
                      alignItems: 'center',
                      justifyContent: 'center',
                      fontSize: isChampionship ? '16px' : '10px',
                      fontWeight: '700',
                      background: isCompleted ? 'var(--accent-green)' :
                                 isCurrent ? (categoryColor || 'var(--accent-gold)') :
                                 'var(--bg-elevated)',
                      color: (isCompleted || isCurrent) ? 'var(--bg-deep)' : 'var(--text-muted)',
                      border: isCurrent ? '2px solid white' : 'none',
                      boxShadow: isCurrent ? `0 0 12px ${categoryColor || 'var(--accent-gold)'}` : 'none',
                      transition: 'all 0.3s ease',
                    }}>
                      {isCompleted ? '‚úì' : isChampionship ? 'üèÜ' : idx + 1}
                    </div>

                    {/* Round name */}
                    <div style={{
                      marginTop: '4px',
                      fontSize: '8px',
                      fontWeight: isCurrent ? '700' : '500',
                      color: isCurrent ? (categoryColor || 'var(--accent-gold)') :
                             isCompleted ? 'var(--accent-green)' : 'var(--text-muted)',
                      textAlign: 'center',
                      lineHeight: 1.1,
                      textTransform: 'uppercase',
                      letterSpacing: '0.5px',
                    }}>
                      {bracketName}
                    </div>
                  </div>

                  {/* Connector line between rounds */}
                  {idx < totalRounds - 1 && (
                    <div style={{
                      flex: '1',
                      height: '2px',
                      background: isCompleted ? 'var(--accent-green)' : 'var(--text-muted)',
                      opacity: isCompleted ? 1 : 0.3,
                      marginTop: '-12px',
                      minWidth: '8px',
                    }} />
                  )}
                </React.Fragment>
              );
            })}
          </div>

          {/* Current round indicator */}
          <div style={{
            marginTop: '10px',
            textAlign: 'center',
            fontSize: '11px',
            color: 'var(--text-secondary)',
          }}>
            {currentRoundIndex + 1} of {totalRounds} rounds complete ‚Üí {totalRounds - currentRoundIndex - 1} to üèÜ
          </div>
        </div>
      );
    }

    // Logo
    function Logo({ size = 'large', onClick = null }) {
      const sizes = {
        large: { title: '64px', sub: '18px' },
        medium: { title: '42px', sub: '14px' },
        small: { title: '28px', sub: '12px' },
      };

      return (
        <div 
          onClick={onClick}
          style={{ 
            textAlign: 'center', 
            marginBottom: size === 'large' ? '40px' : '20px',
            cursor: onClick ? 'pointer' : 'default',
          }}
        >
          <h1 style={{
            fontFamily: 'var(--font-display)',
            fontSize: sizes[size].title,
            letterSpacing: '3px',
            background: 'linear-gradient(135deg, var(--accent-gold) 0%, #ffed4a 50%, var(--accent-gold) 100%)',
            WebkitBackgroundClip: 'text',
            WebkitTextFillColor: 'transparent',
            textShadow: '0 4px 30px rgba(255, 215, 0, 0.3)',
            lineHeight: 1.1,
          }}>
            BATTLE o'<br/>BRACKETS
          </h1>
          <p style={{
            fontFamily: 'var(--font-body)',
            fontSize: sizes[size].sub,
            color: 'var(--text-secondary)',
            marginTop: '8px',
            letterSpacing: '4px',
            textTransform: 'uppercase',
          }}>
            Hosted by BOB
          </p>
        </div>
      );
    }

    // Button
    function Button({ children, onClick, variant = 'primary', disabled = false, size = 'medium', style = {}, className = '' }) {
      const variants = {
        primary: { background: 'linear-gradient(135deg, var(--accent-gold) 0%, #e6c200 100%)', color: 'var(--bg-deep)', border: 'none' },
        secondary: { background: 'transparent', color: 'var(--text-primary)', border: '2px solid var(--text-muted)' },
        danger: { background: 'linear-gradient(135deg, var(--accent-red) 0%, #cc2f4a 100%)', color: 'white', border: 'none' },
        success: { background: 'linear-gradient(135deg, var(--accent-green) 0%, #00b862 100%)', color: 'var(--bg-deep)', border: 'none' },
        ghost: { background: 'rgba(255,255,255,0.05)', color: 'var(--text-secondary)', border: '1px solid var(--text-muted)' },
      };
      const sizes = {
        tiny: { padding: '6px 12px', fontSize: '12px' },
        small: { padding: '14px 24px', fontSize: '14px', minHeight: '44px' },
        medium: { padding: '14px 28px', fontSize: '16px' },
        large: { padding: '18px 36px', fontSize: '18px' },
        huge: { padding: '24px 48px', fontSize: '22px' },
      };

      return (
        <button onClick={onClick} disabled={disabled} className={className} style={{
          ...variants[variant], ...sizes[size],
          fontFamily: 'var(--font-display)',
          letterSpacing: '2px',
          borderRadius: '12px',
          cursor: disabled ? 'not-allowed' : 'pointer',
          opacity: disabled ? 0.5 : 1,
          transition: 'all 0.2s ease',
          textTransform: 'uppercase',
          ...style,
        }}>
          {children}
        </button>
      );
    }

    // Input
    function Input({ value, onChange, placeholder, onKeyDown, style = {} }) {
      return (
        <input
          type="text"
          value={value}
          onChange={(e) => onChange(e.target.value)}
          onKeyDown={onKeyDown}
          placeholder={placeholder}
          style={{
            width: '100%',
            padding: '16px 20px',
            fontSize: '18px',
            fontFamily: 'var(--font-body)',
            background: 'var(--bg-card)',
            border: '2px solid var(--text-muted)',
            borderRadius: '12px',
            color: 'var(--text-primary)',
            outline: 'none',
            transition: 'border-color 0.2s ease',
            ...style,
          }}
          onFocus={(e) => e.target.style.borderColor = 'var(--accent-blue)'}
          onBlur={(e) => e.target.style.borderColor = 'var(--text-muted)'}
        />
      );
    }

    // Entrant Chip
    function EntrantChip({ name, onRemove, index }) {
      return (
        <div className="animate-scaleIn" style={{
          display: 'inline-flex',
          alignItems: 'center',
          gap: '8px',
          background: 'var(--bg-card-hover)',
          border: '1px solid var(--text-muted)',
          borderRadius: '24px',
          padding: '8px 16px',
          animationDelay: `${index * 0.03}s`,
        }}>
          <span style={{ fontSize: '14px' }}>{name}</span>
          {onRemove && (
            <button onClick={onRemove} style={{
              background: 'none', border: 'none', color: 'var(--text-secondary)',
              cursor: 'pointer', padding: '2px', display: 'flex', fontSize: '16px',
            }}>√ó</button>
          )}
        </div>
      );
    }

    // Category Card for Library
    function CategoryCard({ category, onSelect, color }) {
      return (
        <div
          onClick={() => onSelect(category)}
          className="animate-scaleIn"
          style={{
            background: 'var(--bg-card)',
            border: `2px solid ${color}33`,
            borderRadius: '16px',
            padding: '20px',
            cursor: 'pointer',
            transition: 'all 0.2s ease',
          }}
          onMouseEnter={(e) => {
            e.currentTarget.style.borderColor = color;
            e.currentTarget.style.transform = 'translateY(-2px)';
          }}
          onMouseLeave={(e) => {
            e.currentTarget.style.borderColor = `${color}33`;
            e.currentTarget.style.transform = 'translateY(0)';
          }}
        >
          <div style={{
            fontFamily: 'var(--font-display)',
            fontSize: '18px',
            color: color,
            letterSpacing: '1px',
            marginBottom: '8px',
          }}>
            {category.name}
          </div>
          <div style={{
            fontSize: '13px',
            color: 'var(--text-secondary)',
          }}>
            {category.entrants.length} entrants
          </div>
        </div>
      );
    }

    // Theme Pill for Category Groups
    function ThemePill({ theme, isActive, onClick }) {
      const data = CATEGORY_LIBRARY[theme];
      return (
        <button
          onClick={onClick}
          style={{
            display: 'inline-flex',
            alignItems: 'center',
            gap: '8px',
            padding: '10px 20px',
            borderRadius: '24px',
            border: isActive ? `2px solid ${data.color}` : '2px solid var(--text-muted)',
            background: isActive ? `${data.color}22` : 'transparent',
            color: isActive ? data.color : 'var(--text-secondary)',
            fontFamily: 'var(--font-body)',
            fontSize: '14px',
            fontWeight: '500',
            cursor: 'pointer',
            transition: 'all 0.2s ease',
          }}
        >
          <span>{data.icon}</span>
          <span>{data.name}</span>
        </button>
      );
    }

    // Matchup Card
    function MatchupCard({ matchup, onVote, playerCount, isChampionship, categoryType }) {
      const [votesA, setVotesA] = useState(0);
      const [votesB, setVotesB] = useState(0);
      const [locked, setLocked] = useState(false);
      const [showTieBreaker, setShowTieBreaker] = useState(false);
      const [winnerSide, setWinnerSide] = useState(null);
      const [voteKey, setVoteKey] = useState(0); // For vote pop animation

      // Keyboard navigation: Left arrow = vote A, Right arrow = vote B
      useEffect(() => {
        const handleKeyDown = (e) => {
          if (locked || showTieBreaker) return;
          if (e.key === 'ArrowLeft') {
            e.preventDefault();
            setVotesA(v => v + 1);
            setVoteKey(k => k + 1);
            SoundEffects.play('vote');
          } else if (e.key === 'ArrowRight') {
            e.preventDefault();
            setVotesB(v => v + 1);
            setVoteKey(k => k + 1);
            SoundEffects.play('vote');
          } else if (e.key === 'Enter' && (votesA > 0 || votesB > 0)) {
            e.preventDefault();
            // Trigger lock in via a click on the button
            document.querySelector('.lock-in-btn')?.click();
          }
        };
        window.addEventListener('keydown', handleKeyDown);
        return () => window.removeEventListener('keydown', handleKeyDown);
      }, [locked, showTieBreaker, votesA, votesB]);

      const handleVote = (side) => {
        if (locked) return;
        SoundEffects.play('vote');
        setVoteKey(k => k + 1); // Trigger pop animation
        if (side === 'A') setVotesA(v => v + 1);
        else setVotesB(v => v + 1);
      };

      const handleUndo = (side) => {
        if (locked) return;
        if (side === 'A') setVotesA(v => Math.max(0, v - 1));
        else setVotesB(v => Math.max(0, v - 1));
      };

      const handleLockIn = () => {
        if (votesA === votesB) {
          SoundEffects.play('tie');
          setShowTieBreaker(true);
        } else {
          SoundEffects.play('lock');
          const winner = votesA > votesB ? matchup.entrantA : matchup.entrantB;
          const loser = votesA > votesB ? matchup.entrantB : matchup.entrantA;
          const margin = Math.abs(votesA - votesB);
          setWinnerSide(votesA > votesB ? 'A' : 'B');
          setLocked(true);
          // Small delay to show winner animation before advancing
          setTimeout(() => onVote(winner, votesA, votesB, margin, false, loser), 800);
        }
      };

      const handleTieBreaker = (winner) => {
        SoundEffects.play('lock');
        setShowTieBreaker(false);
        const loser = winner === matchup.entrantA ? matchup.entrantB : matchup.entrantA;
        setWinnerSide(winner === matchup.entrantA ? 'A' : 'B');
        setLocked(true);
        setTimeout(() => onVote(winner, votesA, votesB, 0, true, loser), 800);
      };

      if (showTieBreaker) {
        return (
          <div className="animate-shake" style={{
            background: 'linear-gradient(135deg, rgba(255, 59, 92, 0.1) 0%, rgba(255, 59, 92, 0.05) 100%)',
            border: '3px solid var(--accent-red)',
            borderRadius: '20px',
            padding: '32px',
            textAlign: 'center',
          }}>
            <div style={{
              fontFamily: 'var(--font-display)',
              fontSize: '36px',
              color: 'var(--accent-red)',
              marginBottom: '16px',
              letterSpacing: '2px',
            }}>
              ‚ö†Ô∏è IT'S TIED
            </div>
            <BobSays 
              message={BOB.random(BOB.tie)} 
              mood="dramatic"
              subtext={BOB.random(BOB.tieInstructions)}
            />
            <div style={{
              fontFamily: 'var(--font-display)',
              fontSize: '24px',
              color: 'var(--accent-gold)',
              margin: '24px 0',
              letterSpacing: '3px',
            }}>
              üìû PHONE A FRIEND üìû
            </div>
            <div style={{ display: 'flex', gap: '16px', justifyContent: 'center', flexWrap: 'wrap' }}>
              <Button variant="primary" size="large" onClick={() => handleTieBreaker(matchup.entrantA)}>
                {matchup.entrantA} Wins
              </Button>
              <Button variant="primary" size="large" onClick={() => handleTieBreaker(matchup.entrantB)}>
                {matchup.entrantB} Wins
              </Button>
            </div>
          </div>
        );
      }

      return (
        <div style={{
          background: isChampionship 
            ? 'linear-gradient(135deg, rgba(255, 215, 0, 0.1) 0%, rgba(255, 215, 0, 0.02) 100%)'
            : 'var(--bg-card)',
          border: isChampionship ? '3px solid var(--accent-gold)' : '2px solid var(--text-muted)',
          borderRadius: '20px',
          padding: '32px',
          animation: isChampionship ? 'glow 2s ease-in-out infinite' : 'none',
        }}>
          {isChampionship && (
            <div style={{
              textAlign: 'center',
              fontFamily: 'var(--font-display)',
              fontSize: '28px',
              color: 'var(--accent-gold)',
              marginBottom: '24px',
              letterSpacing: '3px',
            }}>
              üèÜ THE CHAMPIONSHIP
            </div>
          )}
          
          <div style={{
            display: 'grid',
            gridTemplateColumns: '1fr auto 1fr',
            gap: '24px',
            alignItems: 'center',
          }}>
            {/* Entrant A */}
            <div
              className={`entrant-card ${locked ? (winnerSide === 'A' ? 'entrant-winner' : 'entrant-loser') : ''}`}
              style={{ textAlign: 'center' }}
            >
              <div style={{
                fontFamily: 'var(--font-display)',
                fontSize: '28px',
                color: locked && winnerSide === 'A' ? 'var(--accent-gold)' : 'var(--text-primary)',
                marginBottom: '16px',
                letterSpacing: '1px',
                transition: 'color 0.3s ease',
              }}>
                {locked && winnerSide === 'A' && 'üëë '}
                {matchup.entrantA}
                {locked && winnerSide === 'A' && ' üëë'}
              </div>
              <div
                key={`a-${voteKey}`}
                className={votesA > 0 ? 'vote-pop' : ''}
                style={{
                  fontSize: '48px',
                  fontFamily: 'var(--font-display)',
                  color: locked && winnerSide === 'A' ? 'var(--accent-gold)' : 'var(--accent-blue)',
                  marginBottom: '16px',
                  transition: 'color 0.3s ease',
                }}
              >
                {votesA}
              </div>
              <div style={{ display: 'flex', gap: '8px', justifyContent: 'center' }}>
                <Button variant="primary" size="small" onClick={() => handleVote('A')} disabled={locked}>+1</Button>
                <Button variant="secondary" size="small" onClick={() => handleUndo('A')} disabled={locked || votesA === 0}>-1</Button>
              </div>
            </div>

            {/* VS Badge */}
            <div
              className={!locked ? 'vs-badge' : ''}
              style={{
                fontFamily: 'var(--font-display)',
                fontSize: '32px',
                color: locked ? 'var(--text-muted)' : 'var(--accent-red)',
                letterSpacing: '4px',
                transition: 'all 0.3s ease',
              }}
            >
              {locked ? '‚öîÔ∏è' : 'VS'}
            </div>

            {/* Entrant B */}
            <div
              className={`entrant-card ${locked ? (winnerSide === 'B' ? 'entrant-winner' : 'entrant-loser') : ''}`}
              style={{ textAlign: 'center', animationDelay: '0.1s' }}
            >
              <div style={{
                fontFamily: 'var(--font-display)',
                fontSize: '28px',
                color: locked && winnerSide === 'B' ? 'var(--accent-gold)' : 'var(--text-primary)',
                marginBottom: '16px',
                letterSpacing: '1px',
                transition: 'color 0.3s ease',
              }}>
                {locked && winnerSide === 'B' && 'üëë '}
                {matchup.entrantB}
                {locked && winnerSide === 'B' && ' üëë'}
              </div>
              <div
                key={`b-${voteKey}`}
                className={votesB > 0 ? 'vote-pop' : ''}
                style={{
                  fontSize: '48px',
                  fontFamily: 'var(--font-display)',
                  color: locked && winnerSide === 'B' ? 'var(--accent-gold)' : 'var(--accent-purple)',
                  marginBottom: '16px',
                  transition: 'color 0.3s ease',
                }}
              >
                {votesB}
              </div>
              <div style={{ display: 'flex', gap: '8px', justifyContent: 'center' }}>
                <Button variant="primary" size="small" onClick={() => handleVote('B')} disabled={locked}>+1</Button>
                <Button variant="secondary" size="small" onClick={() => handleUndo('B')} disabled={locked || votesB === 0}>-1</Button>
              </div>
            </div>
          </div>

          {!locked && (votesA > 0 || votesB > 0) && (
            <div style={{ textAlign: 'center', marginTop: '32px' }}>
              <Button variant="success" size="large" onClick={handleLockIn} className="lock-in-btn">Lock In Result</Button>
            </div>
          )}
        </div>
      );
    }

    // Share Card Generator
    function ShareCard({ champion, category, runnerUp, entrants, playerCount, bobComment, existingShareLink, matchupResults = [], closestCall, biggestBlowout, onClose }) {
      const canvasRef = useRef(null);
      const [imageUrl, setImageUrl] = useState(null);
      const [shareLink, setShareLink] = useState(existingShareLink || null);
      const [isGeneratingLink, setIsGeneratingLink] = useState(false);
      const [linkCopied, setLinkCopied] = useState(false);

      useEffect(() => {
        const canvas = canvasRef.current;
        const ctx = canvas.getContext('2d');

        // Background
        ctx.fillStyle = '#0a0e1a';
        ctx.fillRect(0, 0, 600, 400);

        // Gold gradient header
        const gradient = ctx.createLinearGradient(0, 0, 600, 0);
        gradient.addColorStop(0, '#ffd700');
        gradient.addColorStop(0.5, '#ffed4a');
        gradient.addColorStop(1, '#ffd700');

        // Title
        ctx.font = 'bold 36px Bangers, sans-serif';
        ctx.fillStyle = gradient;
        ctx.textAlign = 'center';
        ctx.fillText("BATTLE o' BRACKETS", 300, 60);

        // Trophy
        ctx.font = '80px serif';
        ctx.fillText('üèÜ', 300, 160);

        // Category
        ctx.font = '18px Outfit, sans-serif';
        ctx.fillStyle = '#8892b0';
        ctx.fillText(category.toUpperCase(), 300, 210);

        // Champion
        ctx.font = 'bold 42px Bangers, sans-serif';
        ctx.fillStyle = '#ffd700';
        ctx.fillText(champion.toUpperCase(), 300, 270);

        // Runner up
        ctx.font = '16px Outfit, sans-serif';
        ctx.fillStyle = '#8892b0';
        ctx.fillText(`defeated ${runnerUp}`, 300, 310);

        // Footer
        ctx.font = '14px Outfit, sans-serif';
        ctx.fillStyle = '#4a5578';
        ctx.fillText('bob.claudewill.io', 300, 370);

        setImageUrl(canvas.toDataURL('image/png'));
      }, [champion, category, runnerUp]);

      const handleDownload = () => {
        const link = document.createElement('a');
        link.download = `bracket-champion-${category.replace(/\s+/g, '-').toLowerCase()}.png`;
        link.href = imageUrl;
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
      };

      const handleCopyText = () => {
        let text = `üèÜ ${champion.toUpperCase()}\nCrowned champion of "${category}" in Battle o' Brackets!\n\ndefeated ${runnerUp} in the final`;

        // Add dramatic moments if available
        const drama = [];
        if (closestCall && closestCall.margin <= 1) {
          drama.push(`üî• Closest call: ${closestCall.winner} def. ${closestCall.loser} (${closestCall.votesA}-${closestCall.votesB})`);
        }
        if (biggestBlowout && biggestBlowout.margin >= 4) {
          drama.push(`üíÄ Biggest blowout: ${biggestBlowout.winner} crushed ${biggestBlowout.loser} (${biggestBlowout.votesA}-${biggestBlowout.votesB})`);
        }
        if (drama.length > 0) {
          text += `\n\n${drama.join('\n')}`;
        }

        text += `\n\n${shareLink || 'bob.claudewill.io'}\n\n#BattleOBrackets`;
        navigator.clipboard.writeText(text);
        alert('Copied to clipboard!');
      };

      const handleGetLink = async () => {
        if (shareLink) {
          // Already have a link, just copy it
          await navigator.clipboard.writeText(shareLink);
          setLinkCopied(true);
          setTimeout(() => setLinkCopied(false), 2000);
          return;
        }

        setIsGeneratingLink(true);
        try {
          const { data, error } = await supabase
            .from('shared_brackets')
            .insert({
              category,
              champion,
              runner_up: runnerUp,
              entrants: entrants || [],
              player_count: playerCount || 1,
              bob_comment: bobComment || '',
            })
            .select('id')
            .single();

          if (error) throw error;

          const link = `${window.location.origin}/b/${data.id}`;
          setShareLink(link);
          await navigator.clipboard.writeText(link);
          setLinkCopied(true);
          setTimeout(() => setLinkCopied(false), 2000);
        } catch (err) {
          console.error('Error creating share link:', err);
          alert('Failed to create share link. Please try again.');
        } finally {
          setIsGeneratingLink(false);
        }
      };

      return (
        <div style={{
          position: 'fixed',
          top: 0, left: 0, right: 0, bottom: 0,
          background: 'rgba(0,0,0,0.9)',
          display: 'flex',
          alignItems: 'center',
          justifyContent: 'center',
          zIndex: 1000,
          padding: '20px',
        }}>
          <div style={{
            background: 'var(--bg-card)',
            borderRadius: '20px',
            padding: '32px',
            maxWidth: '650px',
            width: '100%',
          }}>
            <div style={{
              fontFamily: 'var(--font-display)',
              fontSize: '24px',
              color: 'var(--accent-gold)',
              textAlign: 'center',
              marginBottom: '24px',
              letterSpacing: '2px',
            }}>
              SHARE YOUR CHAMPION
            </div>

            <canvas
              ref={canvasRef}
              width={600}
              height={400}
              style={{
                width: '100%',
                height: 'auto',
                borderRadius: '12px',
                marginBottom: '24px',
              }}
            />

            {shareLink && (
              <div style={{
                background: 'var(--bg-deep)',
                borderRadius: '8px',
                padding: '12px',
                marginBottom: '16px',
                textAlign: 'center',
                fontSize: '14px',
                color: 'var(--accent-gold)',
                wordBreak: 'break-all',
              }}>
                {shareLink}
              </div>
            )}

            <div style={{ display: 'flex', gap: '12px', justifyContent: 'center', flexWrap: 'wrap' }}>
              <Button
                variant="primary"
                onClick={handleGetLink}
                disabled={isGeneratingLink}
              >
                {isGeneratingLink ? 'Creating...' : linkCopied ? '‚úì Link Copied!' : shareLink ? 'Copy Link' : 'üîó Get Shareable Link'}
              </Button>
              <Button variant="secondary" onClick={handleDownload}>Download Image</Button>
              <Button variant="ghost" onClick={handleCopyText}>Copy Text</Button>
              <Button variant="ghost" onClick={onClose}>Close</Button>
            </div>
          </div>
        </div>
      );
    }

    // Champion Screen
    function ChampionScreen({ champion, category, runnerUp, categoryType, bobComment, entrants, playerCount, matchupResults = [], onNewGame, onViewVault }) {
      const [showShare, setShowShare] = useState(false);
      const [shareLink, setShareLink] = useState(null);
      const [shareCopied, setShareCopied] = useState(false);
      const [showRecap, setShowRecap] = useState(false);
      // Use passed bobComment or fall back to random (NYE gets special lines)
      const displayComment = bobComment || BOB.random(categoryType === 'nye' ? BOB.championNYE : BOB.champion);
      const isNYE = categoryType === 'nye';

      // Compute dramatic moments from matchup results
      const closestCall = matchupResults.length > 0
        ? matchupResults.reduce((closest, m) => (!closest || m.margin < closest.margin) ? m : closest, null)
        : null;
      const biggestBlowout = matchupResults.length > 0
        ? matchupResults.reduce((biggest, m) => (!biggest || m.margin > biggest.margin) ? m : biggest, null)
        : null;
      const tieBreakers = matchupResults.filter(m => m.wasTieBreaker);
      const totalVotes = matchupResults.reduce((sum, m) => sum + m.votesA + m.votesB, 0);

      // Auto-generate share link on mount (eager creation)
      useEffect(() => {
        const createShareLink = async () => {
          try {
            const { data, error } = await supabase
              .from('shared_brackets')
              .insert({
                category,
                champion,
                runner_up: runnerUp,
                entrants: entrants || [],
                player_count: playerCount || 1,
                bob_comment: displayComment || '',
              })
              .select('id')
              .single();

            if (!error && data) {
              setShareLink(`${window.location.origin}/b/${data.id}`);
            }
          } catch (err) {
            console.error('Error pre-creating share link:', err);
          }
        };
        createShareLink();
      }, []);

      useEffect(() => {
        SoundEffects.play('champion');
        const duration = 4000;
        const end = Date.now() + duration;
        // NYE gets champagne gold confetti
        const colors = isNYE
          ? ['#ffd700', '#ffed4a', '#fff8dc', '#f5deb3', '#fffacd']
          : ['#ffd700', '#ffed4a', '#ff6b6b', '#4ecdc4', '#45b7d1'];
        const frame = () => {
          confetti({ particleCount: isNYE ? 5 : 3, angle: 60, spread: 55, origin: { x: 0 }, colors });
          confetti({ particleCount: isNYE ? 5 : 3, angle: 120, spread: 55, origin: { x: 1 }, colors });
          if (Date.now() < end) requestAnimationFrame(frame);
        };
        frame();
      }, []);

      return (
        <div style={{
          minHeight: '100vh',
          display: 'flex',
          flexDirection: 'column',
          alignItems: 'center',
          justifyContent: 'center',
          padding: '24px',
          textAlign: 'center',
        }}>
          <div className="animate-scaleIn" style={{
            fontFamily: 'var(--font-display)',
            fontSize: '24px',
            color: 'var(--text-secondary)',
            letterSpacing: '6px',
            marginBottom: '16px',
          }}>
            {category.toUpperCase()}
          </div>
          
          <div className="animate-float" style={{ fontSize: '100px', marginBottom: '16px' }}>üèÜ</div>

          <div className="animate-scaleIn" style={{
            fontFamily: 'var(--font-display)',
            fontSize: '56px',
            background: 'linear-gradient(135deg, var(--accent-gold) 0%, #ffed4a 50%, var(--accent-gold) 100%)',
            WebkitBackgroundClip: 'text',
            WebkitTextFillColor: 'transparent',
            letterSpacing: '3px',
            marginBottom: '24px',
            animationDelay: '0.2s',
          }}>
            {champion.toUpperCase()}
          </div>

          <div style={{ color: 'var(--text-secondary)', fontSize: '18px', marginBottom: '32px' }}>
            defeated <span style={{ color: 'var(--text-primary)' }}>{runnerUp}</span> in the final
          </div>

          <BobSays message={displayComment} mood="victory" />

          {/* Bracket Recap */}
          {matchupResults.length > 0 && (
            <div style={{ marginTop: '24px', width: '100%', maxWidth: '400px' }}>
              <button
                onClick={() => setShowRecap(!showRecap)}
                style={{
                  background: 'var(--bg-card)',
                  border: '1px solid var(--text-muted)',
                  borderRadius: '8px',
                  padding: '12px 20px',
                  cursor: 'pointer',
                  color: 'var(--text-secondary)',
                  fontSize: '14px',
                  width: '100%',
                  display: 'flex',
                  justifyContent: 'space-between',
                  alignItems: 'center',
                }}
              >
                <span>üìä Bracket Recap</span>
                <span style={{ fontSize: '12px' }}>{showRecap ? '‚ñ≤' : '‚ñº'}</span>
              </button>
              {showRecap && (
                <div style={{
                  background: 'var(--bg-card)',
                  border: '1px solid var(--text-muted)',
                  borderTop: 'none',
                  borderRadius: '0 0 8px 8px',
                  padding: '16px',
                  textAlign: 'left',
                }}>
                  <div style={{ fontSize: '13px', color: 'var(--text-muted)', marginBottom: '12px' }}>
                    {matchupResults.length} matchups ‚Ä¢ {totalVotes} total votes
                  </div>

                  {closestCall && closestCall.margin <= 1 && (
                    <div style={{ marginBottom: '12px', padding: '10px', background: 'var(--bg-card-hover)', borderRadius: '6px' }}>
                      <div style={{ fontSize: '11px', color: 'var(--accent-gold)', letterSpacing: '1px', marginBottom: '4px' }}>üî• CLOSEST CALL</div>
                      <div style={{ color: 'var(--text-primary)', fontSize: '14px' }}>
                        {closestCall.winner} def. {closestCall.loser}
                        <span style={{ color: 'var(--text-muted)', marginLeft: '8px' }}>
                          ({closestCall.votesA}-{closestCall.votesB})
                        </span>
                      </div>
                    </div>
                  )}

                  {biggestBlowout && biggestBlowout.margin >= 4 && (
                    <div style={{ marginBottom: '12px', padding: '10px', background: 'var(--bg-card-hover)', borderRadius: '6px' }}>
                      <div style={{ fontSize: '11px', color: 'var(--accent-pink)', letterSpacing: '1px', marginBottom: '4px' }}>üíÄ BIGGEST BLOWOUT</div>
                      <div style={{ color: 'var(--text-primary)', fontSize: '14px' }}>
                        {biggestBlowout.winner} crushed {biggestBlowout.loser}
                        <span style={{ color: 'var(--text-muted)', marginLeft: '8px' }}>
                          ({biggestBlowout.votesA}-{biggestBlowout.votesB})
                        </span>
                      </div>
                    </div>
                  )}

                  {tieBreakers.length > 0 && (
                    <div style={{ marginBottom: '12px', padding: '10px', background: 'var(--bg-card-hover)', borderRadius: '6px' }}>
                      <div style={{ fontSize: '11px', color: 'var(--accent-blue)', letterSpacing: '1px', marginBottom: '4px' }}>üìû TIE-BREAKER{tieBreakers.length > 1 ? 'S' : ''}</div>
                      {tieBreakers.map((t, i) => (
                        <div key={i} style={{ color: 'var(--text-primary)', fontSize: '14px' }}>
                          {t.winner} survived vs {t.loser}
                        </div>
                      ))}
                    </div>
                  )}

                  {/* Championship result */}
                  {matchupResults.find(m => m.isChampionship) && (
                    <div style={{ padding: '10px', background: 'linear-gradient(135deg, #ffd70022, #ffed4a22)', borderRadius: '6px', border: '1px solid #ffd70044' }}>
                      <div style={{ fontSize: '11px', color: 'var(--accent-gold)', letterSpacing: '1px', marginBottom: '4px' }}>üèÜ THE FINAL</div>
                      <div style={{ color: 'var(--text-primary)', fontSize: '14px' }}>
                        {champion} def. {runnerUp}
                        <span style={{ color: 'var(--text-muted)', marginLeft: '8px' }}>
                          ({matchupResults.find(m => m.isChampionship).votesA}-{matchupResults.find(m => m.isChampionship).votesB})
                        </span>
                      </div>
                    </div>
                  )}
                </div>
              )}
            </div>
          )}

          <div style={{ display: 'flex', gap: '16px', marginTop: '24px', flexWrap: 'wrap', justifyContent: 'center' }}>
            <Button variant="primary" size="large" onClick={onNewGame}>New Bracket</Button>
            <Button
              variant="secondary"
              size="large"
              onClick={async () => {
                if (shareLink) {
                  // Try native share sheet first (mobile)
                  if (navigator.share) {
                    try {
                      await navigator.share({
                        title: `${champion} wins ${category}!`,
                        text: `üèÜ ${champion.toUpperCase()} crowned champion of "${category}" in Battle o' Brackets! defeated ${runnerUp} in the final`,
                        url: shareLink,
                      });
                      return; // Success - native share handled it
                    } catch (err) {
                      // User cancelled or share failed - fall through to clipboard
                      if (err.name === 'AbortError') return; // User cancelled, do nothing
                    }
                  }
                  // Fallback: copy to clipboard (desktop or if native share fails)
                  try {
                    await navigator.clipboard.writeText(shareLink);
                    setShareCopied(true);
                    setTimeout(() => setShareCopied(false), 2000);
                  } catch {
                    setShowShare(true); // Fallback to modal if clipboard fails
                  }
                } else {
                  setShowShare(true); // Fallback to modal if link not ready
                }
              }}
            >
              {shareCopied ? '‚úì Copied!' : shareLink ? 'üì§ Share' : 'Share'}
            </Button>
            <Button variant="ghost" size="large" onClick={() => setShowShare(true)}>More Options</Button>
            <Button variant="ghost" size="large" onClick={onViewVault}>The Vault</Button>
          </div>

          {showShare && (
            <ShareCard
              champion={champion}
              category={category}
              runnerUp={runnerUp}
              entrants={entrants}
              playerCount={playerCount}
              bobComment={displayComment}
              existingShareLink={shareLink}
              matchupResults={matchupResults}
              closestCall={closestCall}
              biggestBlowout={biggestBlowout}
              onClose={() => setShowShare(false)}
            />
          )}
        </div>
      );
    }

    // Shared Bracket View - Public read-only view for shared links
    function SharedBracketView({ bracketId }) {
      const [bracket, setBracket] = useState(null);
      const [loading, setLoading] = useState(true);
      const [error, setError] = useState(null);

      useEffect(() => {
        const fetchBracket = async () => {
          try {
            const { data, error: fetchError } = await supabase
              .from('shared_brackets')
              .select('*')
              .eq('id', bracketId)
              .single();

            if (fetchError) throw fetchError;
            if (!data) throw new Error('Bracket not found');

            setBracket(data);

            // Increment view count
            await supabase
              .from('shared_brackets')
              .update({ view_count: (data.view_count || 0) + 1 })
              .eq('id', bracketId);

          } catch (err) {
            setError(err.message);
          } finally {
            setLoading(false);
          }
        };

        fetchBracket();
      }, [bracketId]);

      const handlePlayOwn = () => {
        window.location.href = '/';
      };

      if (loading) {
        return (
          <div style={{
            minHeight: '100vh',
            display: 'flex',
            alignItems: 'center',
            justifyContent: 'center',
            background: 'var(--bg-deep)',
          }}>
            <div style={{ textAlign: 'center' }}>
              <div style={{ fontSize: '48px', marginBottom: '16px' }}>üèÜ</div>
              <div style={{ color: 'var(--text-secondary)' }}>Loading bracket...</div>
            </div>
          </div>
        );
      }

      if (error || !bracket) {
        return (
          <div style={{
            minHeight: '100vh',
            display: 'flex',
            flexDirection: 'column',
            alignItems: 'center',
            justifyContent: 'center',
            background: 'var(--bg-deep)',
            padding: '24px',
            textAlign: 'center',
          }}>
            <Logo size="medium" />
            <div style={{
              fontFamily: 'var(--font-display)',
              fontSize: '32px',
              color: 'var(--accent-red)',
              marginBottom: '16px',
              letterSpacing: '2px',
            }}>
              BRACKET NOT FOUND
            </div>
            <BobSays message="This bracket has vanished into the void. Like tears in rain. Very dramatic." mood="normal" />
            <Button variant="primary" size="large" onClick={handlePlayOwn} style={{ marginTop: '24px' }}>
              Create Your Own Bracket
            </Button>
          </div>
        );
      }

      return (
        <div style={{
          minHeight: '100vh',
          display: 'flex',
          flexDirection: 'column',
          alignItems: 'center',
          justifyContent: 'center',
          background: 'var(--bg-deep)',
          padding: '24px',
          textAlign: 'center',
        }}>
          <Logo size="small" onClick={handlePlayOwn} />

          <div style={{
            fontFamily: 'var(--font-display)',
            fontSize: '20px',
            color: 'var(--text-secondary)',
            letterSpacing: '4px',
            marginBottom: '16px',
            marginTop: '24px',
          }}>
            {bracket.category.toUpperCase()}
          </div>

          <div style={{ fontSize: '80px', marginBottom: '16px' }}>üèÜ</div>

          <div style={{
            fontFamily: 'var(--font-display)',
            fontSize: '48px',
            background: 'linear-gradient(135deg, var(--accent-gold) 0%, #ffed4a 50%, var(--accent-gold) 100%)',
            WebkitBackgroundClip: 'text',
            WebkitTextFillColor: 'transparent',
            letterSpacing: '3px',
            marginBottom: '16px',
          }}>
            {bracket.champion.toUpperCase()}
          </div>

          <div style={{ color: 'var(--text-secondary)', fontSize: '16px', marginBottom: '24px' }}>
            defeated <span style={{ color: 'var(--text-primary)' }}>{bracket.runner_up}</span> in the final
          </div>

          {bracket.bob_comment && (
            <BobSays message={bracket.bob_comment} mood="normal" />
          )}

          <div style={{
            display: 'flex',
            gap: '8px',
            marginTop: '16px',
            color: 'var(--text-muted)',
            fontSize: '14px',
          }}>
            <span>{bracket.player_count || 1} voter{(bracket.player_count || 1) !== 1 ? 's' : ''}</span>
            <span>‚Ä¢</span>
            <span>{bracket.entrants?.length || 0} entrants</span>
            {bracket.view_count > 0 && (
              <>
                <span>‚Ä¢</span>
                <span>{bracket.view_count} view{bracket.view_count !== 1 ? 's' : ''}</span>
              </>
            )}
          </div>

          <div style={{
            marginTop: '32px',
            padding: '20px',
            background: 'var(--bg-card)',
            borderRadius: '16px',
            maxWidth: '400px',
            width: '100%',
          }}>
            <div style={{
              fontFamily: 'var(--font-display)',
              fontSize: '18px',
              color: 'var(--accent-gold)',
              marginBottom: '12px',
              letterSpacing: '2px',
            }}>
              THINK YOU CAN DO BETTER?
            </div>
            <Button variant="primary" size="large" onClick={handlePlayOwn}>
              Create Your Own Bracket
            </Button>
          </div>

          <div style={{
            marginTop: '24px',
            color: 'var(--text-muted)',
            fontSize: '12px',
          }}>
            Shared via Battle o' Brackets‚Ñ¢ ‚Ä¢ Hosted by BOB
          </div>
        </div>
      );
    }

    // The Vault - Carousel Style
    function Vault({ history, onBack, onNewGame, onClearHistory, onDeleteEntry, onEditEntry, onConfirmDelete }) {
      const [currentIndex, setCurrentIndex] = useState(0);
      const [editingIndex, setEditingIndex] = useState(null);
      const [editForm, setEditForm] = useState({});

      // Keyboard navigation
      useEffect(() => {
        const handleKeyDown = (e) => {
          if (editingIndex !== null) return; // Don't navigate while editing
          if (e.key === 'ArrowLeft') {
            e.preventDefault();
            setCurrentIndex(i => Math.max(0, i - 1));
          } else if (e.key === 'ArrowRight') {
            e.preventDefault();
            setCurrentIndex(i => Math.min(history.length - 1, i + 1));
          }
        };
        window.addEventListener('keydown', handleKeyDown);
        return () => window.removeEventListener('keydown', handleKeyDown);
      }, [history.length, editingIndex]);

      const startEdit = (entry) => {
        setEditingIndex(currentIndex);
        setEditForm({
          champion: entry.champion,
          runnerUp: entry.runnerUp,
          note: entry.bobComment || entry.note || '',
        });
      };

      const saveEdit = () => {
        onEditEntry(currentIndex, {
          champion: editForm.champion,
          runnerUp: editForm.runnerUp,
          bobComment: editForm.note,
          note: editForm.note,
        });
        setEditingIndex(null);
        setEditForm({});
      };

      const cancelEdit = () => {
        setEditingIndex(null);
        setEditForm({});
      };

      const handleDelete = () => {
        onConfirmDelete(currentIndex, history[currentIndex]);
        // Adjust index if we're deleting the last item
        if (currentIndex >= history.length - 1 && currentIndex > 0) {
          setCurrentIndex(currentIndex - 1);
        }
      };

      // Empty state
      if (history.length === 0) {
        return (
          <div style={{
            minHeight: '100vh',
            display: 'flex',
            flexDirection: 'column',
            alignItems: 'center',
            justifyContent: 'center',
            padding: '24px',
            textAlign: 'center',
          }}>
            <Logo size="medium" onClick={onBack} />
            <div style={{
              fontFamily: 'var(--font-display)',
              fontSize: '32px',
              color: 'var(--accent-gold)',
              letterSpacing: '3px',
              marginBottom: '24px',
            }}>
              üèÜ THE VAULT
            </div>
            <BobSays message={BOB.random(BOB.vaultEmpty)} mood="normal" />
            <div style={{ display: 'flex', gap: '16px', marginTop: '24px' }}>
              <Button variant="primary" size="large" onClick={onNewGame}>
                Crown Your First Champion
              </Button>
              <Button variant="ghost" size="large" onClick={onBack}>
                ‚Üê Home
              </Button>
            </div>
          </div>
        );
      }

      const entry = history[currentIndex];
      const isEditing = editingIndex === currentIndex;

      return (
        <div style={{
          minHeight: '100vh',
          display: 'flex',
          flexDirection: 'column',
          paddingBottom: '120px', // Space for sticky footer
        }}>
          {/* Header */}
          <div style={{ padding: '24px', textAlign: 'center' }}>
            <Logo size="small" onClick={onBack} />
            <div style={{
              fontFamily: 'var(--font-display)',
              fontSize: '28px',
              color: 'var(--accent-gold)',
              letterSpacing: '3px',
              marginBottom: '8px',
            }}>
              üèÜ THE VAULT
            </div>
            <div style={{ fontSize: '14px', color: 'var(--text-muted)' }}>
              {currentIndex + 1} of {history.length} champions
            </div>
          </div>

          {/* Champion Card - Hero Style */}
          <div style={{
            flex: 1,
            display: 'flex',
            flexDirection: 'column',
            alignItems: 'center',
            justifyContent: 'center',
            padding: '24px',
            maxWidth: '500px',
            margin: '0 auto',
            width: '100%',
          }}>
            <div
              key={currentIndex}
              className="animate-slideUp"
              style={{
                background: 'var(--bg-card)',
                border: '2px solid var(--accent-gold)',
                borderRadius: '20px',
                padding: '32px',
                width: '100%',
                textAlign: 'center',
              }}
            >
              {isEditing ? (
                // Edit mode
                <div style={{ display: 'flex', flexDirection: 'column', gap: '16px', textAlign: 'left' }}>
                  <div style={{
                    fontSize: '14px',
                    color: 'var(--text-muted)',
                    letterSpacing: '2px',
                    textAlign: 'center',
                  }}>
                    {entry.category.toUpperCase()} ‚Ä¢ {entry.date}
                  </div>
                  <div>
                    <label style={{ fontSize: '12px', color: 'var(--text-secondary)', display: 'block', marginBottom: '4px' }}>Champion</label>
                    <input
                      type="text"
                      value={editForm.champion}
                      onChange={(e) => setEditForm({...editForm, champion: e.target.value})}
                      style={{
                        width: '100%',
                        padding: '12px 16px',
                        background: 'var(--bg-deep)',
                        border: '2px solid var(--accent-gold)',
                        borderRadius: '8px',
                        color: 'var(--accent-gold)',
                        fontFamily: 'var(--font-display)',
                        fontSize: '20px',
                        textAlign: 'center',
                      }}
                    />
                  </div>
                  <div>
                    <label style={{ fontSize: '12px', color: 'var(--text-secondary)', display: 'block', marginBottom: '4px' }}>Runner-up</label>
                    <input
                      type="text"
                      value={editForm.runnerUp}
                      onChange={(e) => setEditForm({...editForm, runnerUp: e.target.value})}
                      style={{
                        width: '100%',
                        padding: '10px 16px',
                        background: 'var(--bg-deep)',
                        border: '1px solid var(--text-muted)',
                        borderRadius: '8px',
                        color: 'var(--text-primary)',
                        fontSize: '16px',
                        textAlign: 'center',
                      }}
                    />
                  </div>
                  <div>
                    <label style={{ fontSize: '12px', color: 'var(--text-secondary)', display: 'block', marginBottom: '4px' }}>BOB's Comment</label>
                    <input
                      type="text"
                      value={editForm.note}
                      onChange={(e) => setEditForm({...editForm, note: e.target.value})}
                      placeholder="A memorable moment..."
                      style={{
                        width: '100%',
                        padding: '10px 16px',
                        background: 'var(--bg-deep)',
                        border: '1px solid var(--text-muted)',
                        borderRadius: '8px',
                        color: 'var(--text-primary)',
                        fontSize: '14px',
                        fontStyle: 'italic',
                        textAlign: 'center',
                      }}
                    />
                  </div>
                  <div style={{ display: 'flex', gap: '12px', justifyContent: 'center', marginTop: '8px' }}>
                    <Button variant="primary" onClick={saveEdit}>Save</Button>
                    <Button variant="ghost" onClick={cancelEdit}>Cancel</Button>
                  </div>
                </div>
              ) : (
                // View mode - Hero display
                <>
                  <div style={{
                    fontFamily: 'var(--font-display)',
                    fontSize: '14px',
                    color: 'var(--text-secondary)',
                    letterSpacing: '2px',
                    marginBottom: '16px',
                  }}>
                    {entry.category.toUpperCase()}
                  </div>

                  <div style={{ fontSize: '48px', marginBottom: '16px' }}>üèÜ</div>

                  <div style={{
                    fontFamily: 'var(--font-display)',
                    fontSize: '32px',
                    color: 'var(--accent-gold)',
                    letterSpacing: '2px',
                    marginBottom: '12px',
                    lineHeight: '1.2',
                  }}>
                    {entry.champion.toUpperCase()}
                  </div>

                  <div style={{
                    fontSize: '16px',
                    color: 'var(--text-secondary)',
                    marginBottom: '20px',
                  }}>
                    defeated <span style={{ color: 'var(--text-primary)' }}>{entry.runnerUp}</span>
                  </div>

                  {(entry.bobComment || entry.note) && (
                    <div style={{
                      fontSize: '15px',
                      color: 'var(--text-muted)',
                      fontStyle: 'italic',
                      padding: '16px',
                      background: 'var(--bg-deep)',
                      borderRadius: '12px',
                      marginBottom: '16px',
                    }}>
                      "{entry.bobComment || entry.note}"
                    </div>
                  )}

                  <div style={{
                    fontSize: '13px',
                    color: 'var(--text-muted)',
                    marginBottom: '16px',
                  }}>
                    Crowned {entry.date}
                  </div>

                  {/* Vote history if available */}
                  {entry.matchupResults && entry.matchupResults.length > 0 && (() => {
                    const results = entry.matchupResults;
                    const closest = results.reduce((c, m) => (!c || m.margin < c.margin) ? m : c, null);
                    const biggest = results.reduce((b, m) => (!b || m.margin > b.margin) ? m : b, null);
                    const final = results.find(m => m.isChampionship);
                    const totalVotes = results.reduce((sum, m) => sum + m.votesA + m.votesB, 0);

                    return (
                      <div style={{
                        background: 'var(--bg-deep)',
                        borderRadius: '8px',
                        padding: '12px',
                        marginBottom: '16px',
                        textAlign: 'left',
                        fontSize: '12px',
                      }}>
                        <div style={{ color: 'var(--text-muted)', marginBottom: '8px' }}>
                          {results.length} matchups ‚Ä¢ {totalVotes} votes
                        </div>
                        {final && (
                          <div style={{ color: 'var(--text-secondary)', marginBottom: '4px' }}>
                            üèÜ Final: {final.votesA}-{final.votesB}
                          </div>
                        )}
                        {closest && closest.margin <= 1 && (
                          <div style={{ color: 'var(--accent-gold)', marginBottom: '4px' }}>
                            üî• Closest: {closest.winner} def. {closest.loser} ({closest.votesA}-{closest.votesB})
                          </div>
                        )}
                        {biggest && biggest.margin >= 4 && (
                          <div style={{ color: 'var(--accent-pink)' }}>
                            üíÄ Blowout: {biggest.winner} ({biggest.votesA}-{biggest.votesB})
                          </div>
                        )}
                      </div>
                    );
                  })()}

                  {/* Edit/Delete buttons */}
                  <div style={{ display: 'flex', gap: '12px', justifyContent: 'center' }}>
                    <button
                      onClick={() => startEdit(entry)}
                      style={{
                        background: 'var(--bg-deep)',
                        border: '1px solid var(--text-muted)',
                        borderRadius: '8px',
                        color: 'var(--text-secondary)',
                        cursor: 'pointer',
                        fontSize: '13px',
                        padding: '8px 16px',
                      }}
                    >
                      ‚úèÔ∏è Edit
                    </button>
                    <button
                      onClick={handleDelete}
                      style={{
                        background: 'var(--bg-deep)',
                        border: '1px solid var(--text-muted)',
                        borderRadius: '8px',
                        color: 'var(--text-muted)',
                        cursor: 'pointer',
                        fontSize: '13px',
                        padding: '8px 16px',
                      }}
                    >
                      üóëÔ∏è Delete
                    </button>
                  </div>
                </>
              )}
            </div>
          </div>

          {/* Sticky Footer Navigation */}
          <div style={{
            position: 'fixed',
            bottom: 0,
            left: 0,
            right: 0,
            padding: '16px 24px',
            background: 'linear-gradient(to top, var(--bg-deep) 80%, transparent)',
            zIndex: 100,
          }}>
            <div style={{
              display: 'flex',
              gap: '12px',
              justifyContent: 'center',
              alignItems: 'center',
              maxWidth: '500px',
              margin: '0 auto',
            }}>
              <Button
                variant="ghost"
                onClick={() => setCurrentIndex(i => Math.max(0, i - 1))}
                disabled={currentIndex === 0}
                style={{ opacity: currentIndex === 0 ? 0.3 : 1 }}
              >
                ‚Üê Prev
              </Button>

              <Button variant="primary" size="large" onClick={onNewGame}>
                New Bracket
              </Button>

              <Button
                variant="ghost"
                onClick={() => setCurrentIndex(i => Math.min(history.length - 1, i + 1))}
                disabled={currentIndex === history.length - 1}
                style={{ opacity: currentIndex === history.length - 1 ? 0.3 : 1 }}
              >
                Next ‚Üí
              </Button>
            </div>

            <div style={{
              display: 'flex',
              gap: '16px',
              justifyContent: 'center',
              marginTop: '12px',
            }}>
              <Button variant="ghost" size="small" onClick={onBack}>‚Üê Home</Button>
              <Button variant="ghost" size="small" onClick={onClearHistory} style={{ color: 'var(--accent-red)' }}>
                Clear Vault
              </Button>
            </div>
          </div>
        </div>
      );
    }

    // Category Library Browser
    function CategoryLibrary({ onSelect, onCustom, onBack, customCategories }) {
      const [activeTheme, setActiveTheme] = useState('food');
      const themes = Object.keys(CATEGORY_LIBRARY);
      const currentThemeData = CATEGORY_LIBRARY[activeTheme];

      const handleSurpriseMe = () => {
        const allCategories = [];
        Object.entries(CATEGORY_LIBRARY).forEach(([theme, data]) => {
          data.categories.forEach(cat => {
            allCategories.push({ ...cat, theme });
          });
        });
        const random = allCategories[Math.floor(Math.random() * allCategories.length)];
        onSelect(random, random.theme);
      };

      return (
        <div style={{ minHeight: '100vh', padding: '24px', maxWidth: '700px', margin: '0 auto' }}>
          <Logo size="small" onClick={onBack} />
          
          <div style={{ textAlign: 'center', marginBottom: '20px' }}>
            <div style={{
              fontFamily: 'var(--font-display)',
              fontSize: '24px',
              color: 'var(--accent-gold)',
              letterSpacing: '3px',
              marginBottom: '8px',
            }}>
              PICK A CATEGORY
            </div>
          </div>

          {/* Quick Actions - Prominent */}
          <div style={{
            display: 'flex',
            gap: '12px',
            marginBottom: '20px',
            justifyContent: 'center',
            flexWrap: 'wrap',
            padding: '16px',
            background: 'var(--bg-card)',
            borderRadius: '16px',
            border: '1px solid var(--bg-elevated)',
          }}>
            <div style={{ width: '100%', textAlign: 'center', marginBottom: '8px' }}>
              <span style={{ color: 'var(--text-muted)', fontSize: '13px' }}>Quick start:</span>
            </div>
            <Button variant="primary" size="large" onClick={handleSurpriseMe}>üé≤ Surprise Me!</Button>
            <Button variant="secondary" onClick={onCustom}>‚úèÔ∏è Create Custom</Button>
          </div>

          {/* üî• Hot Takes - Featured Categories */}
          {(() => {
            const featuredCategories = [];
            Object.entries(CATEGORY_LIBRARY).forEach(([theme, data]) => {
              data.categories.forEach(cat => {
                if (cat.featured) {
                  featuredCategories.push({ ...cat, theme, color: data.color });
                }
              });
            });
            return featuredCategories.length > 0 ? (
              <div style={{ marginBottom: '24px' }}>
                <div style={{
                  fontFamily: 'var(--font-display)',
                  fontSize: '16px',
                  color: 'var(--accent-gold)',
                  letterSpacing: '2px',
                  marginBottom: '12px',
                  textAlign: 'center',
                }}>
                  üî• HOT TAKES
                </div>
                <div style={{
                  display: 'flex',
                  gap: '12px',
                  overflowX: 'auto',
                  paddingBottom: '8px',
                  WebkitOverflowScrolling: 'touch',
                }}>
                  {featuredCategories.map((cat) => (
                    <button
                      key={cat.name}
                      onClick={() => onSelect(cat, cat.theme)}
                      style={{
                        flexShrink: 0,
                        background: 'var(--bg-card)',
                        border: `2px solid ${cat.color}`,
                        borderRadius: '12px',
                        padding: '12px 16px',
                        cursor: 'pointer',
                        textAlign: 'left',
                        minWidth: '160px',
                      }}
                    >
                      <div style={{
                        fontFamily: 'var(--font-display)',
                        fontSize: '14px',
                        color: cat.color,
                        letterSpacing: '1px',
                      }}>
                        {cat.name}
                      </div>
                      <div style={{
                        fontSize: '11px',
                        color: 'var(--text-muted)',
                        marginTop: '4px',
                      }}>
                        {cat.entrants.length} entrants
                      </div>
                    </button>
                  ))}
                </div>
              </div>
            ) : null;
          })()}

          <div style={{ textAlign: 'center', color: 'var(--text-muted)', fontSize: '13px', marginBottom: '16px' }}>
            ‚Äî or browse by theme ‚Äî
          </div>

          {/* Theme Pills */}
          <div style={{ 
            display: 'flex', 
            gap: '8px', 
            flexWrap: 'wrap', 
            marginBottom: '24px',
            justifyContent: 'center',
          }}>
            {themes.map(theme => (
              <ThemePill
                key={theme}
                theme={theme}
                isActive={activeTheme === theme}
                onClick={() => setActiveTheme(theme)}
              />
            ))}
          </div>

          {/* Category Grid */}
          <div style={{
            display: 'grid',
            gridTemplateColumns: 'repeat(auto-fill, minmax(200px, 1fr))',
            gap: '16px',
            marginBottom: '24px',
          }}>
            {currentThemeData.categories.map((cat, i) => (
              <CategoryCard
                key={cat.name}
                category={cat}
                color={currentThemeData.color}
                onSelect={() => onSelect(cat, activeTheme)}
              />
            ))}
          </div>

          {/* Custom Categories */}
          {customCategories.length > 0 && (
            <>
              <div style={{
                fontFamily: 'var(--font-display)',
                fontSize: '18px',
                color: 'var(--text-secondary)',
                letterSpacing: '2px',
                marginBottom: '16px',
                textAlign: 'center',
              }}>
                YOUR CUSTOM CATEGORIES
              </div>
              <div style={{
                display: 'grid',
                gridTemplateColumns: 'repeat(auto-fill, minmax(200px, 1fr))',
                gap: '16px',
              }}>
                {customCategories.map((cat, i) => (
                  <CategoryCard
                    key={cat.name}
                    category={cat}
                    color="var(--accent-pink)"
                    onSelect={() => onSelect(cat, 'custom')}
                  />
                ))}
              </div>
            </>
          )}

          <div style={{ textAlign: 'center', marginTop: '32px' }}>
            <Button variant="ghost" onClick={onBack}>‚Üê Home</Button>
          </div>
        </div>
      );
    }

    // Settings Panel
    function SettingsPanel({ soundEnabled, onToggleSound, onFeedback, onAdmin, onAbout, onLegal, onDevTools, isDevMode, onClose }) {
      return (
        <div style={{
          position: 'fixed',
          top: '20px',
          right: '20px',
          background: 'var(--bg-card)',
          border: '2px solid var(--text-muted)',
          borderRadius: '16px',
          padding: '20px',
          zIndex: 100,
          minWidth: '200px',
        }}>
          <div style={{
            fontFamily: 'var(--font-display)',
            fontSize: '16px',
            color: 'var(--accent-gold)',
            letterSpacing: '2px',
            marginBottom: '16px',
          }}>
            SETTINGS
          </div>

          <div
            onClick={onToggleSound}
            style={{
              display: 'flex',
              alignItems: 'center',
              justifyContent: 'space-between',
              padding: '12px',
              background: 'var(--bg-card-hover)',
              borderRadius: '8px',
              cursor: 'pointer',
              marginBottom: '12px',
            }}
          >
            <span style={{ color: 'var(--text-primary)' }}>Sound Effects</span>
            <span style={{ color: soundEnabled ? 'var(--accent-green)' : 'var(--text-muted)' }}>
              {soundEnabled ? 'üîä ON' : 'üîá OFF'}
            </span>
          </div>

          <div
            onClick={() => { onClose(); onFeedback(); }}
            style={{
              display: 'flex',
              alignItems: 'center',
              justifyContent: 'space-between',
              padding: '12px',
              background: 'var(--bg-card-hover)',
              borderRadius: '8px',
              cursor: 'pointer',
              marginBottom: '12px',
            }}
          >
            <span style={{ color: 'var(--text-primary)' }}>Send Feedback</span>
            <span style={{ color: 'var(--accent-blue)' }}>üí¨</span>
          </div>

          <div
            onClick={() => { onClose(); onAdmin(); }}
            style={{
              display: 'flex',
              alignItems: 'center',
              justifyContent: 'space-between',
              padding: '12px',
              background: 'var(--bg-card-hover)',
              borderRadius: '8px',
              cursor: 'pointer',
              marginBottom: '12px',
            }}
          >
            <span style={{ color: 'var(--text-primary)' }}>View Feedback</span>
            <span style={{ color: 'var(--accent-purple)' }}>üìä</span>
          </div>

          <div
            onClick={() => { onClose(); onAbout(); }}
            style={{
              display: 'flex',
              alignItems: 'center',
              justifyContent: 'space-between',
              padding: '12px',
              background: 'var(--bg-card-hover)',
              borderRadius: '8px',
              cursor: 'pointer',
              marginBottom: '12px',
            }}
          >
            <span style={{ color: 'var(--text-primary)' }}>About</span>
            <span style={{ color: 'var(--accent-gold)' }}>‚ÑπÔ∏è</span>
          </div>

          <div
            onClick={() => { window.open('https://ko-fi.com/derekclaude', '_blank'); }}
            style={{
              display: 'flex',
              alignItems: 'center',
              justifyContent: 'space-between',
              padding: '12px',
              background: 'linear-gradient(135deg, #ff5e5b22, #ff793f22)',
              borderRadius: '8px',
              cursor: 'pointer',
              marginBottom: '12px',
              border: '1px solid #ff5e5b44',
            }}
          >
            <span style={{ color: 'var(--text-primary)' }}>Tip BOB a Coffee</span>
            <span>‚òï</span>
          </div>

          <div
            onClick={() => { onClose(); onLegal(); }}
            style={{
              display: 'flex',
              alignItems: 'center',
              justifyContent: 'space-between',
              padding: '12px',
              background: 'var(--bg-card-hover)',
              borderRadius: '8px',
              cursor: 'pointer',
              marginBottom: '12px',
            }}
          >
            <span style={{ color: 'var(--text-primary)' }}>Privacy & Terms</span>
            <span style={{ color: 'var(--text-muted)' }}>üìú</span>
          </div>

          {isDevMode && (
            <div
              onClick={() => { onClose(); onDevTools(); }}
              style={{
                display: 'flex',
                alignItems: 'center',
                justifyContent: 'space-between',
                padding: '12px',
                background: 'var(--bg-card-hover)',
                borderRadius: '8px',
                cursor: 'pointer',
                marginBottom: '12px',
                border: '1px dashed var(--accent-pink)',
              }}
            >
              <span style={{ color: 'var(--accent-pink)' }}>Dev Tools</span>
              <span style={{ color: 'var(--accent-pink)' }}>üõ†Ô∏è</span>
            </div>
          )}

          <Button variant="ghost" size="small" onClick={onClose} style={{ width: '100%' }}>
            Close
          </Button>
        </div>
      );
    }

    // Feedback Modal
    function FeedbackModal({ onClose }) {
      const [message, setMessage] = useState('');
      const [status, setStatus] = useState('idle'); // idle, sending, sent, error

      const handleSubmit = async () => {
        if (!message.trim()) return;

        setStatus('sending');
        try {
          const { error } = await supabase
            .from('feedback')
            .insert([{ message: message.trim(), category: 'general' }]);

          if (error) throw error;
          setStatus('sent');
          setTimeout(() => onClose(), 1500);
        } catch (err) {
          console.error('Feedback error:', err);
          setStatus('error');
        }
      };

      return (
        <div style={{
          position: 'fixed',
          top: 0,
          left: 0,
          right: 0,
          bottom: 0,
          background: 'rgba(0, 0, 0, 0.8)',
          display: 'flex',
          alignItems: 'center',
          justifyContent: 'center',
          zIndex: 200,
          padding: '20px',
        }}>
          <div style={{
            background: 'var(--bg-card)',
            border: '2px solid var(--accent-gold)',
            borderRadius: '16px',
            padding: '24px',
            maxWidth: '400px',
            width: '100%',
          }}>
            <div style={{
              fontFamily: 'var(--font-display)',
              fontSize: '20px',
              color: 'var(--accent-gold)',
              letterSpacing: '2px',
              marginBottom: '16px',
              textAlign: 'center',
            }}>
              SEND FEEDBACK
            </div>

            <p style={{
              color: 'var(--text-secondary)',
              marginBottom: '16px',
              textAlign: 'center',
              fontSize: '14px',
            }}>
              What's broken? What's fun? What would make you play again?
            </p>

            <textarea
              value={message}
              onChange={(e) => setMessage(e.target.value)}
              placeholder="Your feedback..."
              disabled={status !== 'idle'}
              style={{
                width: '100%',
                minHeight: '120px',
                padding: '12px',
                background: 'var(--bg-deep)',
                border: '2px solid var(--text-muted)',
                borderRadius: '8px',
                color: 'var(--text-primary)',
                fontFamily: 'var(--font-body)',
                fontSize: '16px',
                resize: 'vertical',
                marginBottom: '16px',
              }}
            />

            {status === 'sent' && (
              <div style={{
                color: 'var(--accent-green)',
                textAlign: 'center',
                marginBottom: '16px',
                fontWeight: '600',
              }}>
                Thanks! BOB appreciates it.
              </div>
            )}

            {status === 'error' && (
              <div style={{
                color: 'var(--accent-red)',
                textAlign: 'center',
                marginBottom: '16px',
              }}>
                Oops, something went wrong. Try again?
              </div>
            )}

            <div style={{ display: 'flex', gap: '12px' }}>
              <Button
                variant="ghost"
                onClick={onClose}
                disabled={status === 'sending'}
                style={{ flex: 1 }}
              >
                Cancel
              </Button>
              <Button
                variant="primary"
                onClick={handleSubmit}
                disabled={!message.trim() || status === 'sending' || status === 'sent'}
                style={{ flex: 1 }}
              >
                {status === 'sending' ? 'Sending...' : status === 'sent' ? 'Sent!' : 'Send'}
              </Button>
            </div>
          </div>
        </div>
      );
    }

    // Feedback Admin Panel
    function FeedbackAdmin({ onClose }) {
      const [feedback, setFeedback] = useState([]);
      const [loading, setLoading] = useState(true);

      useEffect(() => {
        loadFeedback();
      }, []);

      const loadFeedback = async () => {
        setLoading(true);
        const { data, error } = await supabase
          .from('feedback')
          .select('*')
          .order('created_at', { ascending: false });

        if (!error && data) {
          setFeedback(data);
        }
        setLoading(false);
      };

      const deleteFeedback = async (id) => {
        await supabase.from('feedback').delete().eq('id', id);
        setFeedback(feedback.filter(f => f.id !== id));
      };

      const formatDate = (dateString) => {
        const date = new Date(dateString);
        return date.toLocaleDateString('en-US', {
          month: 'short',
          day: 'numeric',
          hour: 'numeric',
          minute: '2-digit'
        });
      };

      return (
        <div style={{
          position: 'fixed',
          top: 0,
          left: 0,
          right: 0,
          bottom: 0,
          background: 'rgba(0, 0, 0, 0.9)',
          display: 'flex',
          alignItems: 'flex-start',
          justifyContent: 'center',
          zIndex: 200,
          padding: '20px',
          overflowY: 'auto',
        }}>
          <div style={{
            background: 'var(--bg-card)',
            border: '2px solid var(--accent-purple)',
            borderRadius: '16px',
            padding: '24px',
            maxWidth: '600px',
            width: '100%',
            marginTop: '20px',
            marginBottom: '20px',
          }}>
            <div style={{
              display: 'flex',
              justifyContent: 'space-between',
              alignItems: 'center',
              marginBottom: '20px',
            }}>
              <div style={{
                fontFamily: 'var(--font-display)',
                fontSize: '20px',
                color: 'var(--accent-purple)',
                letterSpacing: '2px',
              }}>
                FEEDBACK ({feedback.length})
              </div>
              <Button variant="ghost" size="small" onClick={onClose}>Close</Button>
            </div>

            {loading ? (
              <div style={{ textAlign: 'center', color: 'var(--text-secondary)', padding: '40px' }}>
                Loading...
              </div>
            ) : feedback.length === 0 ? (
              <div style={{ textAlign: 'center', color: 'var(--text-secondary)', padding: '40px' }}>
                No feedback yet
              </div>
            ) : (
              <div style={{ display: 'flex', flexDirection: 'column', gap: '12px' }}>
                {feedback.map((item) => (
                  <div
                    key={item.id}
                    style={{
                      background: 'var(--bg-deep)',
                      borderRadius: '8px',
                      padding: '16px',
                      border: '1px solid var(--text-muted)',
                    }}
                  >
                    <div style={{
                      display: 'flex',
                      justifyContent: 'space-between',
                      alignItems: 'flex-start',
                      marginBottom: '8px',
                    }}>
                      <div style={{
                        fontSize: '12px',
                        color: 'var(--text-muted)',
                      }}>
                        {formatDate(item.created_at)}
                      </div>
                      <button
                        onClick={() => deleteFeedback(item.id)}
                        style={{
                          background: 'none',
                          border: 'none',
                          color: 'var(--accent-red)',
                          cursor: 'pointer',
                          fontSize: '12px',
                          opacity: 0.7,
                        }}
                      >
                        Delete
                      </button>
                    </div>
                    <div style={{
                      color: 'var(--text-primary)',
                      fontSize: '14px',
                      lineHeight: '1.5',
                      whiteSpace: 'pre-wrap',
                    }}>
                      {item.message}
                    </div>
                  </div>
                ))}
              </div>
            )}
          </div>
        </div>
      );
    }

    // About Modal
    function AboutModal({ onClose }) {
      const SectionTitle = ({ children }) => (
        <div style={{
          fontFamily: 'var(--font-display)',
          fontSize: '14px',
          color: 'var(--accent-gold)',
          letterSpacing: '2px',
          marginBottom: '12px',
          marginTop: '24px',
        }}>
          {children}
        </div>
      );

      return (
        <div style={{
          position: 'fixed',
          top: 0,
          left: 0,
          right: 0,
          bottom: 0,
          background: 'rgba(0, 0, 0, 0.9)',
          display: 'flex',
          alignItems: 'flex-start',
          justifyContent: 'center',
          zIndex: 200,
          padding: '20px',
          overflowY: 'auto',
        }}>
          <div style={{
            background: 'var(--bg-card)',
            border: '2px solid var(--accent-gold)',
            borderRadius: '16px',
            padding: '32px',
            maxWidth: '500px',
            width: '100%',
            marginTop: '20px',
            marginBottom: '20px',
          }}>
            {/* Header */}
            <div style={{ textAlign: 'center', marginBottom: '24px' }}>
              <div style={{ fontFamily: 'var(--font-display)', fontSize: '48px', marginBottom: '8px', letterSpacing: '4px', color: 'var(--accent-gold)', fontWeight: 'bold' }}>
                ]-[
              </div>
              <div style={{
                fontFamily: 'var(--font-display)',
                fontSize: '28px',
                color: 'var(--accent-gold)',
                letterSpacing: '3px',
                marginBottom: '8px',
              }}>
                BATTLE O' BRACKETS
              </div>
              <div style={{ fontSize: '14px', color: 'var(--text-muted)' }}>
                Version 1.0
              </div>
            </div>

            {/* Tagline */}
            <div style={{
              fontSize: '18px',
              color: 'var(--text-primary)',
              lineHeight: '1.6',
              textAlign: 'center',
              fontStyle: 'italic',
              marginBottom: '8px',
            }}>
              "Build a bracket. Vote. Crown a champion."
            </div>
            <div style={{
              fontSize: '16px',
              color: 'var(--text-secondary)',
              textAlign: 'center',
              marginBottom: '24px',
            }}>
              Family game night just got a lot more interesting.
            </div>

            {/* How It Works */}
            <SectionTitle>HOW IT WORKS</SectionTitle>
            <div style={{
              background: 'var(--bg-deep)',
              borderRadius: '8px',
              padding: '16px',
              fontSize: '14px',
              lineHeight: '1.8',
            }}>
              <div style={{ marginBottom: '8px' }}>
                <span style={{ color: 'var(--accent-gold)' }}>1.</span>
                <span style={{ color: 'var(--text-primary)', marginLeft: '8px' }}>Pick a category (or make your own)</span>
              </div>
              <div style={{ marginBottom: '8px' }}>
                <span style={{ color: 'var(--accent-gold)' }}>2.</span>
                <span style={{ color: 'var(--text-primary)', marginLeft: '8px' }}>Add your contenders</span>
              </div>
              <div style={{ marginBottom: '8px' }}>
                <span style={{ color: 'var(--accent-gold)' }}>3.</span>
                <span style={{ color: 'var(--text-primary)', marginLeft: '8px' }}>Vote head-to-head until one reigns supreme</span>
              </div>
              <div>
                <span style={{ color: 'var(--accent-gold)' }}>4.</span>
                <span style={{ color: 'var(--text-primary)', marginLeft: '8px' }}>Champions live forever in The Vault</span>
              </div>
            </div>

            {/* Who is BOB */}
            <SectionTitle>WHO IS BOB?</SectionTitle>
            <div style={{
              fontSize: '14px',
              color: 'var(--text-secondary)',
              lineHeight: '1.7',
              fontStyle: 'italic',
            }}>
              "I'm BOB. Battle o' Brackets. Yes, it's an acronym. I'm based on a real person ‚Äî Uncle Robert Jake ‚Äî who had opinions about everything and the dry wit to make them memorable. One of 11 kids. Trombone player. Early riser. I carry his spirit. Mostly the judgment."
            </div>
            <div style={{
              fontSize: '13px',
              color: 'var(--text-muted)',
              lineHeight: '1.6',
              marginTop: '12px',
            }}>
              Also channeling: Bob Barker's warmth, Bob Newhart's deadpan timing, Bob Eubanks' chaos tolerance, and Bob Ross's calm in the storm.
            </div>

            {/* Origin Story */}
            <SectionTitle>THE ORIGIN STORY</SectionTitle>
            <div style={{
              fontSize: '14px',
              color: 'var(--text-secondary)',
              lineHeight: '1.7',
              fontStyle: 'italic',
            }}>
              "I was created by Derek Claude Simmons and his AI collaborator, Anthropic's Claude. Derek's a media strategy guy from Minneapolis who thought family debates needed structure. Claude's an AI who seemed genuinely relieved to work on something fun. Together they built this. I'm the result."
            </div>

            {/* Close Button */}
            <div style={{ marginTop: '32px', textAlign: 'center' }}>
              <Button variant="primary" onClick={onClose}>
                Got it. Let's battle.
              </Button>
            </div>
          </div>
        </div>
      );
    }

    // Legal Modal (Privacy Policy & Terms of Use)
    function LegalModal({ onClose }) {
      const [activeTab, setActiveTab] = useState('privacy');

      const TabButton = ({ id, label }) => (
        <div
          onClick={() => setActiveTab(id)}
          style={{
            flex: 1,
            padding: '12px',
            textAlign: 'center',
            cursor: 'pointer',
            fontFamily: 'var(--font-display)',
            fontSize: '12px',
            letterSpacing: '1px',
            color: activeTab === id ? 'var(--accent-gold)' : 'var(--text-muted)',
            borderBottom: activeTab === id ? '2px solid var(--accent-gold)' : '2px solid transparent',
            transition: 'all 0.2s ease',
          }}
        >
          {label}
        </div>
      );

      const SectionTitle = ({ children }) => (
        <div style={{
          fontFamily: 'var(--font-display)',
          fontSize: '13px',
          color: 'var(--accent-gold)',
          letterSpacing: '1px',
          marginBottom: '8px',
          marginTop: '20px',
        }}>
          {children}
        </div>
      );

      const Paragraph = ({ children }) => (
        <div style={{
          fontSize: '13px',
          color: 'var(--text-secondary)',
          lineHeight: '1.7',
          marginBottom: '12px',
        }}>
          {children}
        </div>
      );

      return (
        <div style={{
          position: 'fixed',
          top: 0,
          left: 0,
          right: 0,
          bottom: 0,
          background: 'rgba(0, 0, 0, 0.9)',
          display: 'flex',
          alignItems: 'flex-start',
          justifyContent: 'center',
          zIndex: 200,
          padding: '20px',
          overflowY: 'auto',
        }}>
          <div style={{
            background: 'var(--bg-card)',
            border: '2px solid var(--accent-gold)',
            borderRadius: '16px',
            padding: '24px',
            maxWidth: '500px',
            width: '100%',
            marginTop: '20px',
            marginBottom: '20px',
          }}>
            {/* Header */}
            <div style={{ textAlign: 'center', marginBottom: '20px' }}>
              <div style={{
                fontFamily: 'var(--font-display)',
                fontSize: '24px',
                color: 'var(--accent-gold)',
                letterSpacing: '2px',
              }}>
                LEGAL STUFF
              </div>
              <div style={{ fontSize: '12px', color: 'var(--text-muted)', marginTop: '4px' }}>
                Last updated: December 2024
              </div>
            </div>

            {/* Tabs */}
            <div style={{
              display: 'flex',
              borderBottom: '1px solid var(--text-muted)',
              marginBottom: '16px',
            }}>
              <TabButton id="privacy" label="PRIVACY POLICY" />
              <TabButton id="terms" label="TERMS OF USE" />
            </div>

            {/* Content */}
            <div style={{
              maxHeight: '400px',
              overflowY: 'auto',
              paddingRight: '8px',
            }}>
              {activeTab === 'privacy' ? (
                <div>
                  <Paragraph>
                    Battle o' Brackets ("BOB") is a party game that respects your privacy. Here's what we collect and why.
                  </Paragraph>

                  <SectionTitle>WHAT WE COLLECT</SectionTitle>
                  <Paragraph>
                    <strong style={{ color: 'var(--text-primary)' }}>Game Data (Anonymous):</strong> When you crown a champion, we save the category, winner, runner-up, and player count. No names, no emails, no way to identify you.
                  </Paragraph>
                  <Paragraph>
                    <strong style={{ color: 'var(--text-primary)' }}>Custom Categories:</strong> If you create a custom category, we save it so others might enjoy it too. Anonymous.
                  </Paragraph>
                  <Paragraph>
                    <strong style={{ color: 'var(--text-primary)' }}>Feedback:</strong> If you send feedback, we save your message. That's it.
                  </Paragraph>
                  <Paragraph>
                    <strong style={{ color: 'var(--text-primary)' }}>Shared Brackets:</strong> When you share a bracket, it becomes publicly viewable via a unique link. We track view counts on shared brackets.
                  </Paragraph>

                  <SectionTitle>LOCAL STORAGE</SectionTitle>
                  <Paragraph>
                    Your champion history ("The Vault") and custom categories are stored on your device only. We don't sync this data to our servers unless you explicitly share a bracket.
                  </Paragraph>

                  <SectionTitle>NO TRACKING</SectionTitle>
                  <Paragraph>
                    We don't use cookies. We don't use Google Analytics or any third-party tracking. We don't sell data. We don't have data worth selling.
                  </Paragraph>

                  <SectionTitle>DATA DELETION</SectionTitle>
                  <Paragraph>
                    Want your data deleted? Email derek@claudewill.io with your request. Since everything is anonymous, you'll need to tell us what to look for.
                  </Paragraph>

                  <SectionTitle>THIRD PARTIES</SectionTitle>
                  <Paragraph>
                    We use Supabase for our database and Netlify for hosting. Google Fonts loads our typography. That's the complete list.
                  </Paragraph>
                </div>
              ) : (
                <div>
                  <Paragraph>
                    By using Battle o' Brackets, you agree to these terms. They're pretty reasonable.
                  </Paragraph>

                  <SectionTitle>THE GAME</SectionTitle>
                  <Paragraph>
                    BOB is a free party game. Use it for fun, family debates, and settling important questions like "best pizza topping." We provide it "as is" ‚Äî no warranties, no guarantees that your family won't argue about the results.
                  </Paragraph>

                  <SectionTitle>SHARED BRACKETS</SectionTitle>
                  <Paragraph>
                    When you share a bracket, it becomes public. Anyone with the link can view it. Think before you share ‚Äî especially if your bracket reveals controversial opinions about potato salad.
                  </Paragraph>

                  <SectionTitle>YOUR CONTENT</SectionTitle>
                  <Paragraph>
                    Custom categories and entrants you create are yours. By submitting them, you give us permission to display and share them within the app. Don't submit anything offensive, illegal, or that you don't have rights to.
                  </Paragraph>

                  <SectionTitle>DON'T BE A JERK</SectionTitle>
                  <Paragraph>
                    Don't abuse the service. Don't try to break it. Don't use it to harass people. Don't create categories designed to be hateful or harmful. BOB has opinions, but he's not mean-spirited.
                  </Paragraph>

                  <SectionTitle>CHANGES</SectionTitle>
                  <Paragraph>
                    We might update these terms. If we do, we'll update the date at the top. Continued use means you accept the changes.
                  </Paragraph>

                  <SectionTitle>CONTACT</SectionTitle>
                  <Paragraph>
                    Questions? Email derek@claudewill.io. BOB doesn't answer email, but Derek does.
                  </Paragraph>
                </div>
              )}
            </div>

            {/* Close Button */}
            <div style={{ marginTop: '24px', textAlign: 'center' }}>
              <Button variant="primary" onClick={onClose}>
                Got it
              </Button>
            </div>
          </div>
        </div>
      );
    }

    // Confirm Modal (replaces browser confirm)
    function ConfirmModal({ message, onConfirm, onCancel, confirmText = "Yes", cancelText = "Cancel", variant = "danger" }) {
      return (
        <div style={{
          position: 'fixed',
          top: 0,
          left: 0,
          right: 0,
          bottom: 0,
          background: 'rgba(0, 0, 0, 0.9)',
          display: 'flex',
          alignItems: 'center',
          justifyContent: 'center',
          zIndex: 300,
          padding: '20px',
        }}>
          <div style={{
            background: 'var(--bg-card)',
            border: `2px solid ${variant === 'danger' ? 'var(--accent-red)' : 'var(--accent-gold)'}`,
            borderRadius: '16px',
            padding: '32px',
            maxWidth: '400px',
            width: '100%',
            textAlign: 'center',
          }}>
            <div style={{
              fontSize: '18px',
              color: 'var(--text-primary)',
              lineHeight: '1.6',
              marginBottom: '24px',
            }}>
              {message}
            </div>
            <div style={{ display: 'flex', gap: '12px', justifyContent: 'center' }}>
              <Button variant="ghost" onClick={onCancel}>
                {cancelText}
              </Button>
              <Button
                variant={variant === 'danger' ? 'secondary' : 'primary'}
                onClick={onConfirm}
                style={variant === 'danger' ? { background: 'var(--accent-red)', borderColor: 'var(--accent-red)' } : {}}
              >
                {confirmText}
              </Button>
            </div>
          </div>
        </div>
      );
    }

    // Dev Tools Modal (only shown in dev mode)
    function DevToolsModal({ onClose, onClearAll, onResetFirstVisit, onResetVault }) {
      return (
        <div style={{
          position: 'fixed',
          top: 0,
          left: 0,
          right: 0,
          bottom: 0,
          background: 'rgba(0, 0, 0, 0.9)',
          display: 'flex',
          alignItems: 'center',
          justifyContent: 'center',
          zIndex: 300,
          padding: '20px',
        }}>
          <div style={{
            background: 'var(--bg-card)',
            border: '2px solid var(--accent-pink)',
            borderRadius: '16px',
            padding: '32px',
            maxWidth: '400px',
            width: '100%',
          }}>
            <div style={{
              fontFamily: 'var(--font-display)',
              fontSize: '20px',
              color: 'var(--accent-pink)',
              letterSpacing: '2px',
              marginBottom: '24px',
              textAlign: 'center',
            }}>
              üõ†Ô∏è DEV TOOLS
            </div>

            <div style={{ display: 'flex', flexDirection: 'column', gap: '12px' }}>
              <Button variant="secondary" onClick={() => { onResetFirstVisit(); onClose(); }}>
                Reset First Visit (show About)
              </Button>
              <Button variant="secondary" onClick={() => { onResetVault(); onClose(); }}>
                Reset Vault to Seed Data
              </Button>
              <Button variant="danger" onClick={() => { onClearAll(); onClose(); }}>
                Clear All localStorage
              </Button>
            </div>

            <div style={{
              marginTop: '24px',
              padding: '12px',
              background: 'var(--bg-deep)',
              borderRadius: '8px',
              fontSize: '12px',
              color: 'var(--text-muted)',
            }}>
              <div><strong>Tip:</strong> Add <code>?dev=true</code> to URL to access dev tools</div>
            </div>

            <div style={{ marginTop: '24px', textAlign: 'center' }}>
              <Button variant="ghost" onClick={onClose}>Close</Button>
            </div>
          </div>
        </div>
      );
    }

    // ============================================
    // SEED VAULT DATA (Family Bracket Winners)
    // ============================================
    const SEED_VAULT_DATA = [
      {
        category: "Christmas Songs",
        champion: "Baby Please Come Home (Darlene Love)",
        runnerUp: "All I Want For Christmas (Mariah Carey)",
        date: "12/8/2024",
        categoryType: "preset",
        bobComment: "Mariah had the whistle tone. Darlene had the soul. Soul won."
      },
      {
        category: "Cereal",
        champion: "Cinnamon Toast Crunch",
        runnerUp: "Honey Nut Cheerios",
        date: "12/8/2024",
        categoryType: "preset",
        bobComment: "The cereal that sees why kids love it defeated the one endorsed by a bee. Nature is healing."
      },
      {
        category: "College Mascots",
        champion: "Michigan Wolverines",
        runnerUp: "Kansas Jayhawks",
        date: "12/7/2024",
        categoryType: "custom",
        bobComment: "The Jayhawks flew too close to the sun. Wolverines don't fly. They win."
      },
      {
        category: "Animated Movies",
        champion: "Toy Story",
        runnerUp: "Monsters Inc.",
        date: "12/7/2024",
        categoryType: "preset",
        bobComment: "You've got a friend in democracy."
      },
      {
        category: "Rock Bands",
        champion: "Nirvana",
        runnerUp: "Guns N' Roses",
        date: "12/6/2024",
        categoryType: "preset",
        bobComment: "Foo got knocked out by Coldplay? Yeah, that really happened."
      },
      {
        category: "Chips",
        champion: "Dill Pickle",
        runnerUp: "Sour Cream & Onion",
        date: "12/6/2024",
        categoryType: "preset",
        bobComment: "Chaos prevailed. As it should."
      },
      {
        category: "Christmas Cookies",
        champion: "Molasses",
        runnerUp: "Sugar Cookie",
        date: "12/5/2024",
        categoryType: "custom",
        bobComment: "Slow and steady wins the cookie race. Poetic."
      },
      {
        category: "Cheese",
        champion: "Aged Havarti",
        runnerUp: "Sharp Cheddar",
        date: "12/5/2024",
        categoryType: "preset",
        bobComment: "A cheese with patience. I respect that."
      },
      {
        category: "Candy",
        champion: "Werther's Original",
        runnerUp: "Reese's",
        date: "12/4/2024",
        categoryType: "preset",
        bobComment: "Grandma energy. Undefeated."
      },
      {
        category: "Crayon Colors",
        champion: "Sea Foam Green",
        runnerUp: "Cerulean",
        date: "12/4/2024",
        categoryType: "custom",
        bobComment: "Bold. Controversial. Correct."
      },
      {
        category: "Dog Breeds",
        champion: "Golden Retriever",
        runnerUp: "Goldendoodle",
        date: "12/3/2024",
        categoryType: "preset",
        bobComment: "Jordy the doodle against Jasper the greyhound. The retriever outlasted them all."
      },
      {
        category: "Thanksgiving Food",
        champion: "Green Bean Casserole",
        runnerUp: "Mashed Potatoes",
        date: "11/28/2024",
        categoryType: "preset",
        bobComment: "The side dish that hosts Thanksgiving. Turkey is just the venue."
      },
      {
        category: "Food Pairings",
        champion: "Bacon and Eggs",
        runnerUp: "Peanut Butter & Jelly",
        date: "11/27/2024",
        categoryType: "custom",
        bobComment: "The combo that built empires."
      },
    ];

    // ============================================
    // MAIN APP
    // ============================================
    function App() {
      // Check for shared bracket view: /b/[id]
      const sharedBracketMatch = window.location.pathname.match(/^\/b\/([a-f0-9-]+)$/i);
      if (sharedBracketMatch) {
        return <SharedBracketView bracketId={sharedBracketMatch[1]} />;
      }

      // Dev mode: add ?dev=true to URL for testing tools
      const isDevMode = new URLSearchParams(window.location.search).get('dev') === 'true';

      const [screen, setScreen] = useState('home');
      const [category, setCategory] = useState('');
      const [categoryType, setCategoryType] = useState('custom');
      const [entrants, setEntrants] = useState([]);
      const [newEntrant, setNewEntrant] = useState('');
      const [playerCount, setPlayerCount] = useState(() => {
        const saved = localStorage.getItem('bob-player-count');
        return saved ? parseInt(saved, 10) : 4;
      });
      const [bracket, setBracket] = useState(null);
      const [currentRoundIndex, setCurrentRoundIndex] = useState(0);
      const [currentMatchupIndex, setCurrentMatchupIndex] = useState(0);
      const [winners, setWinners] = useState([]);
      const [matchupResults, setMatchupResults] = useState([]); // Track all matchup votes for recap
      const [finalBracketResults, setFinalBracketResults] = useState([]); // Complete results for champion screen
      const [champion, setChampion] = useState(null);
      const [runnerUp, setRunnerUp] = useState(null);
      const [championComment, setChampionComment] = useState('');
      const [bobMessage, setBobMessage] = useState('');
      const [bobMood, setBobMood] = useState('normal');
      const [showSettings, setShowSettings] = useState(false);
      const [showFeedback, setShowFeedback] = useState(false);
      const [showAdmin, setShowAdmin] = useState(false);
      const [showAbout, setShowAbout] = useState(false);
      const [showLegal, setShowLegal] = useState(false);
      const [confirmModal, setConfirmModal] = useState(null);
      const [showDevTools, setShowDevTools] = useState(false);
      const [soundEnabled, setSoundEnabled] = useState(true);
      const [canUndo, setCanUndo] = useState(false);
      const [undoState, setUndoState] = useState(null);

      // Year in Review mode
      const [isYearInReview, setIsYearInReview] = useState(false);
      const [yirRound, setYirRound] = useState(0); // 1-4, then 5 for MVP
      const [yirWinners, setYirWinners] = useState([]);
      const YIR_CATEGORIES = [
        { name: "Best Month of 2025", entrants: ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"] },
        { name: "Best NYE Resolution", entrants: ["Exercise More", "Eat Healthier", "Save Money", "Learn Something New", "Read More Books", "Travel More", "Quit Bad Habits", "Spend Time with Family", "Get Organized", "Be More Present", "Start a Side Hustle", "Meditate Daily", "Drink More Water", "Sleep Better", "Less Screen Time", "Say Yes More"] },
        { name: "Best NYE Tradition", entrants: ["Midnight Kiss", "Champagne Toast", "Ball Drop Watch", "Countdown", "Fireworks", "Resolutions", "First Footer", "Noisemakers", "Sparklers", "Eating 12 Grapes", "Wearing White", "Burning Effigies", "Polar Plunge", "Black-Eyed Peas", "Hoppin' John", "Staying Up Till Midnight"] },
        { name: "Best NYE Drink", entrants: ["Champagne", "Prosecco", "Mimosa", "French 75", "Espresso Martini", "Cosmopolitan", "Manhattan", "Old Fashioned", "Aperol Spritz", "Moscow Mule", "Margarita", "Sparkling Cider", "Hot Toddy", "Mulled Wine", "Mocktail Spritz", "Shirley Temple"] },
      ];

      const [history, setHistory] = useState(() => {
        const saved = localStorage.getItem('bob-vault-v2');
        if (saved) {
          const parsed = JSON.parse(saved);
          // Only use saved data if it has entries, otherwise seed with family data
          if (parsed.length > 0) {
            return parsed;
          }
        }
        // Pre-populate with family bracket winners for new users
        return SEED_VAULT_DATA;
      });

      const [customCategories, setCustomCategories] = useState(() => {
        const saved = localStorage.getItem('bob-custom-categories');
        return saved ? JSON.parse(saved) : [];
      });

      useEffect(() => {
        localStorage.setItem('bob-vault-v2', JSON.stringify(history));
      }, [history]);

      useEffect(() => {
        localStorage.setItem('bob-custom-categories', JSON.stringify(customCategories));
      }, [customCategories]);

      useEffect(() => {
        localStorage.setItem('bob-player-count', playerCount.toString());
      }, [playerCount]);

      // Show About modal on first visit
      useEffect(() => {
        const hasVisited = localStorage.getItem('bob-has-visited');
        if (!hasVisited) {
          setShowAbout(true);
          localStorage.setItem('bob-has-visited', 'true');
        }
      }, []);

      const handleToggleSound = () => {
        const newState = SoundEffects.toggle();
        setSoundEnabled(newState);
      };

      // Year in Review functions
      const startYearInReview = () => {
        setIsYearInReview(true);
        setYirRound(1);
        setYirWinners([]);
        // Start first category
        const firstCat = YIR_CATEGORIES[0];
        setCategory(firstCat.name);
        setCategoryType('nye');
        setEntrants([...firstCat.entrants]);
        const { rounds, structure } = generateBracket(firstCat.entrants);
        setBracket({ rounds, structure, category: firstCat.name });
        setCurrentRoundIndex(0);
        setCurrentMatchupIndex(0);
        setWinners([]);
        setMatchupResults([]);
        setBobMessage("Year in Review. Four brackets. Four champions. One MVP. Let's find out what 2025 was really about.");
        setBobMood('normal');
        setScreen('playing');
      };

      const advanceYearInReview = (winner) => {
        const newWinners = [...yirWinners, winner];
        setYirWinners(newWinners);

        if (yirRound < 4) {
          // Start next category
          const nextCat = YIR_CATEGORIES[yirRound]; // yirRound is 1-indexed, array is 0-indexed
          setYirRound(yirRound + 1);
          setCategory(nextCat.name);
          setEntrants([...nextCat.entrants]);
          const { rounds, structure } = generateBracket(nextCat.entrants);
          setBracket({ rounds, structure, category: nextCat.name });
          setCurrentRoundIndex(0);
          setCurrentMatchupIndex(0);
          setWinners([]);
          setMatchupResults([]);
          setBobMessage(`Champion ${yirRound} of 4: ${winner}. ${4 - yirRound} more to crown. Onward.`);
          setScreen('playing');
        } else {
          // All 4 done - create MVP bracket
          setYirRound(5);
          const mvpCategory = "MVP of 2025";
          setCategory(mvpCategory);
          setEntrants([...newWinners]);
          const { rounds, structure } = generateBracket(newWinners);
          setBracket({ rounds, structure, category: mvpCategory });
          setCurrentRoundIndex(0);
          setCurrentMatchupIndex(0);
          setWinners([]);
          setMatchupResults([]);
          setBobMessage(`Four champions crowned: ${newWinners.join(', ')}. Now they face each other. The MVP of 2025 awaits.`);
          setScreen('playing');
        }
      };

      const handleSelectFromLibrary = (categoryData, theme) => {
        setCategory(categoryData.name);
        setCategoryType(theme);
        setEntrants([...categoryData.entrants]);
        setBobMessage(BOB.random(BOB.quickStart));
        setBobMood('normal');
        setScreen('setup');
      };

      const addEntrant = () => {
        if (newEntrant.trim() && !entrants.includes(newEntrant.trim())) {
          setEntrants([...entrants, newEntrant.trim()]);
          setNewEntrant('');
        }
      };

      const removeEntrant = (index) => {
        setEntrants(entrants.filter((_, i) => i !== index));
      };

      const saveCustomCategory = () => {
        if (category.trim() && entrants.length >= 4) {
          const existing = customCategories.findIndex(c => c.name === category);
          const newCat = { name: category, entrants: [...entrants] };
          if (existing >= 0) {
            const updated = [...customCategories];
            updated[existing] = newCat;
            setCustomCategories(updated);
          } else {
            setCustomCategories([...customCategories, newCat]);

            // Track new custom category in Supabase (fire and forget)
            supabase.from('custom_categories').insert({
              category_name: category,
              entrants: [...entrants],
              entrant_count: entrants.length,
            }).then(() => {}).catch(() => {});
          }
        }
      };

      const startGame = () => {
        if (entrants.length < 4) {
          setBobMessage("You need at least 4 entrants. That's barely a bracket.");
          return;
        }
        
        const { rounds, structure } = generateBracket(entrants);
        setBracket({ rounds, structure, category });
        setCurrentRoundIndex(0);
        setCurrentMatchupIndex(0);
        setWinners([]);
        setMatchupResults([]);

        // Category-aware opener
        const opener = BOB.getCategoryComment(categoryType, 'categoryOpeners');
        setBobMessage(opener);
        setBobMood('normal');
        setScreen('playing');
      };

      const handleVoteResult = (winner, votesA, votesB, margin, wasTieBreaker = false, loser = null) => {
        // Save state for undo before advancing
        setUndoState({
          winners: [...winners],
          currentMatchupIndex,
          currentRoundIndex,
          bracket: JSON.parse(JSON.stringify(bracket)),
          matchupResults: [...matchupResults],
        });

        const newWinners = [...winners, winner];
        setWinners(newWinners);

        // Record this matchup result for recap
        const currentRound = bracket.rounds[currentRoundIndex];
        const matchup = currentRound.matchups[currentMatchupIndex];
        setMatchupResults(prev => [...prev, {
          winner,
          loser,
          votesA,
          votesB,
          margin,
          wasTieBreaker,
          round: currentRound.name || `Round ${currentRoundIndex + 1}`,
          isChampionship: currentRound.name === 'Championship',
        }]);

        let reaction;

        // Check for BOB self-awareness (bob-adjacent items)
        const winnerIsBob = BOB.isBobAdjacent(winner);
        const loserIsBob = BOB.isBobAdjacent(loser);

        if (winnerIsBob) {
          // BOB-adjacent item won! BOB is pleased.
          reaction = BOB.random(BOB.bobAdjacent.winner);
        } else if (loserIsBob) {
          // BOB-adjacent item lost. BOB is... processing.
          reaction = BOB.random(BOB.bobAdjacent.loser);
        } else if (wasTieBreaker) {
          reaction = BOB.random(BOB.tieResolved);
        } else if (margin >= 4) {
          reaction = BOB.random(BOB.blowout);
        } else if (margin <= 1) {
          reaction = BOB.random(BOB.close);
        } else {
          // Normal result - sometimes use deadpan for variety
          reaction = Math.random() < 0.3
            ? BOB.random(BOB.deadpan)
            : BOB.random(BOB.normal);
        }
        setBobMessage(reaction);

        setTimeout(() => {
          const currentRound = bracket.rounds[currentRoundIndex];
          
          if (currentMatchupIndex < currentRound.matchups.length - 1) {
            const nextMatchupIndex = currentMatchupIndex + 1;
            setCurrentMatchupIndex(nextMatchupIndex);
            SoundEffects.play('advance');

            // Check if next matchup has bob-adjacent items
            const nextMatchup = currentRound.matchups[nextMatchupIndex];
            const hasBobItem = BOB.isBobAdjacent(nextMatchup?.entrantA) || BOB.isBobAdjacent(nextMatchup?.entrantB);

            if (hasBobItem && Math.random() < 0.7) {
              // BOB notices a kindred spirit in the matchup
              setBobMessage(BOB.random(BOB.bobAdjacent.matchup));
            } else if (Math.random() < 0.15) {
              // Occasionally drop life advice between matchups
              setBobMessage(BOB.random(BOB.bobAdvice));
            } else {
              const intro = BOB.random(BOB.matchupIntros);
              const contextComment = BOB.getCategoryComment(categoryType, 'matchupCommentary');
              setBobMessage(`${intro} ${contextComment || ''}`);
            }
          } else {
            const roundWinners = [...newWinners];
            if (currentRound.byes) roundWinners.push(...currentRound.byes);
            
            if (roundWinners.length === 1) {
              const lastMatchup = currentRound.matchups[currentMatchupIndex];
              const loser = lastMatchup.entrantA === winner ? lastMatchup.entrantB : lastMatchup.entrantA;

              // Year in Review: advance to next bracket instead of champion screen
              if (isYearInReview && yirRound < 5) {
                // Save this bracket's result to vault
                const comment = `Year in Review Round ${yirRound} champion`;
                const newEntry = {
                  category,
                  champion: winner,
                  runnerUp: loser,
                  date: new Date().toLocaleDateString(),
                  categoryType: 'nye',
                  bobComment: comment,
                };
                setHistory([newEntry, ...history]);
                // Advance to next YIR round
                setTimeout(() => advanceYearInReview(winner), 1500);
                return;
              }

              setChampion(winner);
              setRunnerUp(loser);

              // Generate and capture BOB's championship comment
              const comment = isYearInReview
                ? "The MVP of 2025. All four champions competed. One prevailed. This is the one that defined your year."
                : BOB.random(categoryType === 'nye' ? BOB.championNYE : BOB.champion);
              setChampionComment(comment);

              // Reset Year in Review state if we're finishing MVP round
              if (isYearInReview) {
                setIsYearInReview(false);
                setYirRound(0);
                setYirWinners([]);
              }

              // Include the final matchup in results
              const finalResults = [...matchupResults, {
                winner,
                loser,
                votesA: votesA,
                votesB: votesB,
                margin: Math.abs(votesA - votesB),
                wasTieBreaker: false,
                round: 'Championship',
                isChampionship: true,
              }];
              setFinalBracketResults(finalResults);

              const newEntry = {
                category,
                champion: winner,
                runnerUp: loser,
                date: new Date().toLocaleDateString(),
                categoryType: isYearInReview ? 'nye' : categoryType,
                bobComment: comment,
                matchupResults: finalResults,
              };
              setHistory([newEntry, ...history]);

              // Track game in Supabase (fire and forget)
              supabase.from('games').insert({
                category,
                category_type: categoryType,
                champion: winner,
                runner_up: loser,
                player_count: playerCount,
                entrant_count: entrants.length,
                matchup_results: JSON.stringify(finalResults),
              }).then(() => {}).catch(() => {});

              setScreen('champion');
            } else if (roundWinners.length === 2) {
              const champRound = {
                name: 'Championship',
                matchups: [{
                  id: 'final',
                  entrantA: roundWinners[0],
                  entrantB: roundWinners[1],
                  winner: null, votesA: 0, votesB: 0,
                }],
              };
              setBracket(prev => ({ ...prev, rounds: [...prev.rounds, champRound] }));
              setCurrentRoundIndex(currentRoundIndex + 1);
              setCurrentMatchupIndex(0);
              setWinners([]);
              SoundEffects.play('dramatic');
              setBobMessage(BOB.random(BOB.championshipIntro));
              setBobMood('excited');
            } else {
              const nextMatchups = [];
              for (let i = 0; i < roundWinners.length; i += 2) {
                nextMatchups.push({
                  id: `r${currentRoundIndex + 2}-${i/2}`,
                  entrantA: roundWinners[i],
                  entrantB: roundWinners[i + 1],
                  winner: null, votesA: 0, votesB: 0,
                });
              }
              
              // Name round based on teams remaining
              const teamsInRound = nextMatchups.length * 2;
              let roundName;
              if (teamsInRound === 4) roundName = 'Final Four';
              else if (teamsInRound === 8) roundName = 'Elite 8';
              else if (teamsInRound === 16) roundName = 'Sweet 16';
              else roundName = `Round of ${teamsInRound}`;
              const nextRound = { name: roundName, matchups: nextMatchups };
              
              setBracket(prev => ({ ...prev, rounds: [...prev.rounds, nextRound] }));
              setCurrentRoundIndex(currentRoundIndex + 1);
              setCurrentMatchupIndex(0);
              setWinners([]);
              SoundEffects.play('roundComplete');
              // Sometimes show impatience when starting new round
              if (Math.random() < 0.25) {
                setBobMessage(BOB.random(BOB.impatience));
              } else {
                setBobMessage(BOB.random(BOB.matchupIntros));
              }
              setBobMood('normal');
            }
          }
          // Enable undo for 5 seconds after advancing
          setCanUndo(true);
          setTimeout(() => setCanUndo(false), 5000);
        }, 1500);
      };

      const handleUndo = () => {
        if (!canUndo || !undoState) return;

        // Restore previous state
        setWinners(undoState.winners);
        setMatchupResults(undoState.matchupResults || []);
        setCurrentMatchupIndex(undoState.currentMatchupIndex);
        setCurrentRoundIndex(undoState.currentRoundIndex);
        setBracket(undoState.bracket);
        setCanUndo(false);
        setUndoState(null);
        setBobMessage("Fine. Let's redo that one. Democracy demands accuracy.");
        SoundEffects.play('vote');
      };

      const resetGame = () => {
        setCategory('');
        setCategoryType('custom');
        setEntrants([]);
        setNewEntrant('');
        setBracket(null);
        setCurrentRoundIndex(0);
        setCurrentMatchupIndex(0);
        setWinners([]);
        setMatchupResults([]);
        setFinalBracketResults([]);
        setChampion(null);
        setRunnerUp(null);
        setChampionComment('');
        setBobMessage('');
        setBobMood('normal');
        // Reset Year in Review state
        setIsYearInReview(false);
        setYirRound(0);
        setYirWinners([]);
        setScreen('home');
      };

      const clearHistory = () => {
        setConfirmModal({
          message: 'Clear all champions from The Vault? This cannot be undone.',
          confirmText: 'Clear All',
          onConfirm: () => {
            setHistory([]);
            setConfirmModal(null);
          },
        });
      };

      const deleteEntry = (index) => {
        setHistory(prev => prev.filter((_, i) => i !== index));
      };

      const editEntry = (index, updates) => {
        setHistory(prev => prev.map((entry, i) =>
          i === index ? { ...entry, ...updates } : entry
        ));
      };

      // ============================================
      // RENDER
      // ============================================

      // Settings button (always visible except home)
      const SettingsButton = () => (
        <button
          onClick={() => setShowSettings(!showSettings)}
          style={{
            position: 'fixed',
            top: '20px',
            right: '20px',
            background: 'var(--bg-card)',
            border: '2px solid var(--text-muted)',
            borderRadius: '12px',
            padding: '10px 14px',
            cursor: 'pointer',
            zIndex: 50,
            fontSize: '18px',
          }}
        >
          ‚öôÔ∏è
        </button>
      );

      // HOME
      if (screen === 'home') {
        return (
          <div style={{
            minHeight: '100vh',
            display: 'flex',
            flexDirection: 'column',
            alignItems: 'center',
            justifyContent: 'center',
            padding: '24px',
          }}>
            <Logo size="large" />
            <BobSays message={BOB.random(BOB.welcome)} mood="normal" />
            <div style={{ display: 'flex', gap: '16px', flexWrap: 'wrap', justifyContent: 'center' }}>
              <Button variant="primary" size="huge" onClick={() => setScreen('library')}>
                üéØ Quick Start
              </Button>
              <Button variant="secondary" size="huge" onClick={() => {
                setCategoryType('custom');
                setScreen('setup');
              }}>
                ‚úèÔ∏è Custom Bracket
              </Button>
            </div>
            <div style={{ marginTop: '24px' }}>
              <Button variant="ghost" size="large" onClick={() => setScreen('vault')}>
                üèÜ The Vault{history.length > 0 ? ` (${history.length})` : ''}
              </Button>
            </div>

            {/* Year in Review - special NYE mode */}
            <div style={{ marginTop: '16px' }}>
              <button
                onClick={startYearInReview}
                style={{
                  background: 'linear-gradient(135deg, #f59e0b 0%, #fbbf24 50%, #f59e0b 100%)',
                  border: 'none',
                  borderRadius: '12px',
                  padding: '14px 28px',
                  cursor: 'pointer',
                  fontSize: '16px',
                  fontFamily: 'var(--font-display)',
                  color: '#1a1a2e',
                  letterSpacing: '2px',
                  boxShadow: '0 4px 15px rgba(245, 158, 11, 0.4)',
                  transition: 'transform 0.2s, box-shadow 0.2s',
                }}
                onMouseOver={e => {
                  e.currentTarget.style.transform = 'scale(1.05)';
                  e.currentTarget.style.boxShadow = '0 6px 20px rgba(245, 158, 11, 0.6)';
                }}
                onMouseOut={e => {
                  e.currentTarget.style.transform = 'scale(1)';
                  e.currentTarget.style.boxShadow = '0 4px 15px rgba(245, 158, 11, 0.4)';
                }}
              >
                ü•Ç YEAR IN REVIEW 2025
              </button>
              <div style={{ fontSize: '12px', color: 'var(--text-muted)', marginTop: '8px', textAlign: 'center' }}>
                4 brackets ‚Üí 1 MVP
              </div>
            </div>

            <button
              onClick={() => setShowSettings(!showSettings)}
              style={{
                position: 'fixed',
                top: '20px',
                right: '20px',
                background: 'var(--bg-card)',
                border: '2px solid var(--text-muted)',
                borderRadius: '12px',
                padding: '10px 14px',
                cursor: 'pointer',
                fontSize: '18px',
                color: 'var(--text-primary)',
              }}
            >
              ‚öôÔ∏è
            </button>
            
            {showSettings && (
              <SettingsPanel
                soundEnabled={soundEnabled}
                onToggleSound={handleToggleSound}
                onFeedback={() => setShowFeedback(true)}
                onAdmin={() => setShowAdmin(true)}
                onAbout={() => setShowAbout(true)}
                onLegal={() => setShowLegal(true)}
                onDevTools={() => setShowDevTools(true)}
                isDevMode={isDevMode}
                onClose={() => setShowSettings(false)}
              />
            )}
            {showFeedback && <FeedbackModal onClose={() => setShowFeedback(false)} />}
            {showAdmin && <FeedbackAdmin onClose={() => setShowAdmin(false)} />}
            {showAbout && <AboutModal onClose={() => setShowAbout(false)} />}
            {showLegal && <LegalModal onClose={() => setShowLegal(false)} />}
            {confirmModal && <ConfirmModal message={confirmModal.message} confirmText={confirmModal.confirmText} onConfirm={confirmModal.onConfirm} onCancel={() => setConfirmModal(null)} variant={confirmModal.variant} />}
            {showDevTools && <DevToolsModal
              onClose={() => setShowDevTools(false)}
              onClearAll={() => { localStorage.clear(); window.location.reload(); }}
              onResetFirstVisit={() => { localStorage.removeItem('bob-has-visited'); window.location.reload(); }}
              onResetVault={() => { setHistory(SEED_VAULT_DATA); }}
            />}
          </div>
        );
      }

      // LIBRARY
      if (screen === 'library') {
        return (
          <>
            <SettingsButton />
            {showSettings && (
              <SettingsPanel soundEnabled={soundEnabled} onToggleSound={handleToggleSound} onFeedback={() => setShowFeedback(true)} onAdmin={() => setShowAdmin(true)} onAbout={() => setShowAbout(true)} onLegal={() => setShowLegal(true)} onDevTools={() => setShowDevTools(true)} isDevMode={isDevMode} onClose={() => setShowSettings(false)} />
            )}
            <CategoryLibrary
              onSelect={handleSelectFromLibrary}
              onCustom={() => {
                setCategoryType('custom');
                setScreen('setup');
              }}
              onBack={() => setScreen('home')}
              customCategories={customCategories}
            />
            {showFeedback && <FeedbackModal onClose={() => setShowFeedback(false)} />}
            {showAdmin && <FeedbackAdmin onClose={() => setShowAdmin(false)} />}
            {showAbout && <AboutModal onClose={() => setShowAbout(false)} />}
            {showLegal && <LegalModal onClose={() => setShowLegal(false)} />}
            {confirmModal && <ConfirmModal message={confirmModal.message} confirmText={confirmModal.confirmText} onConfirm={confirmModal.onConfirm} onCancel={() => setConfirmModal(null)} variant={confirmModal.variant} />}
            {showDevTools && <DevToolsModal onClose={() => setShowDevTools(false)} onClearAll={() => { localStorage.clear(); window.location.reload(); }} onResetFirstVisit={() => { localStorage.removeItem('bob-has-visited'); window.location.reload(); }} onResetVault={() => { setHistory(SEED_VAULT_DATA); }} />}
          </>
        );
      }

      // VAULT
      if (screen === 'vault') {
        return (
          <>
            <SettingsButton />
            {showSettings && (
              <SettingsPanel soundEnabled={soundEnabled} onToggleSound={handleToggleSound} onFeedback={() => setShowFeedback(true)} onAdmin={() => setShowAdmin(true)} onAbout={() => setShowAbout(true)} onLegal={() => setShowLegal(true)} onDevTools={() => setShowDevTools(true)} isDevMode={isDevMode} onClose={() => setShowSettings(false)} />
            )}
            <Vault
              history={history}
              onBack={() => setScreen('home')}
              onNewGame={() => setScreen('library')}
              onClearHistory={clearHistory}
              onDeleteEntry={deleteEntry}
              onEditEntry={editEntry}
              onConfirmDelete={(index, entry) => {
                setConfirmModal({
                  message: `Delete "${entry.champion}" from ${entry.category}?`,
                  confirmText: 'Delete',
                  onConfirm: () => {
                    deleteEntry(index);
                    setConfirmModal(null);
                  },
                });
              }}
            />
            {showFeedback && <FeedbackModal onClose={() => setShowFeedback(false)} />}
            {showAdmin && <FeedbackAdmin onClose={() => setShowAdmin(false)} />}
            {showAbout && <AboutModal onClose={() => setShowAbout(false)} />}
            {showLegal && <LegalModal onClose={() => setShowLegal(false)} />}
            {confirmModal && <ConfirmModal message={confirmModal.message} confirmText={confirmModal.confirmText} onConfirm={confirmModal.onConfirm} onCancel={() => setConfirmModal(null)} variant={confirmModal.variant} />}
            {showDevTools && <DevToolsModal onClose={() => setShowDevTools(false)} onClearAll={() => { localStorage.clear(); window.location.reload(); }} onResetFirstVisit={() => { localStorage.removeItem('bob-has-visited'); window.location.reload(); }} onResetVault={() => { setHistory(SEED_VAULT_DATA); }} />}
          </>
        );
      }

      // SETUP
      if (screen === 'setup') {
        const structure = calculateBracketStructure(entrants.length);
        const canStart = category.trim() && entrants.length >= 4;

        return (
          <div style={{ minHeight: '100vh', paddingBottom: '100px' }}>
            <div style={{ padding: '24px', maxWidth: '600px', margin: '0 auto' }}>
              <SettingsButton />
              {showSettings && (
                <SettingsPanel soundEnabled={soundEnabled} onToggleSound={handleToggleSound} onFeedback={() => setShowFeedback(true)} onAdmin={() => setShowAdmin(true)} onAbout={() => setShowAbout(true)} onLegal={() => setShowLegal(true)} onDevTools={() => setShowDevTools(true)} isDevMode={isDevMode} onClose={() => setShowSettings(false)} />
              )}

              <Logo size="small" onClick={() => setScreen('home')} />

              {bobMessage && <BobSays message={bobMessage} mood={bobMood} />}

              {/* Category */}
              <div style={{ marginBottom: '24px' }}>
                <label style={{
                  display: 'block',
                  fontFamily: 'var(--font-display)',
                  fontSize: '16px',
                  color: 'var(--text-secondary)',
                  letterSpacing: '2px',
                  marginBottom: '8px',
                }}>
                  CATEGORY
                </label>
                <Input value={category} onChange={setCategory} placeholder="Best Pizza Topping..." />
              </div>

              {/* Player Count */}
              <div style={{ marginBottom: '24px' }}>
                <label style={{
                  display: 'block',
                  fontFamily: 'var(--font-display)',
                  fontSize: '16px',
                  color: 'var(--text-secondary)',
                  letterSpacing: '2px',
                  marginBottom: '8px',
                }}>
                  VOTERS: {playerCount}
                </label>
                <div style={{ display: 'flex', gap: '6px', flexWrap: 'wrap' }}>
                  {[1, 2, 3, 4, 5, 6, 7, 8, 9, 10].map(n => (
                    <button
                      key={n}
                      onClick={() => setPlayerCount(n)}
                      style={{
                        width: '40px', height: '40px', borderRadius: '10px',
                        border: playerCount === n ? '2px solid var(--accent-gold)' : '2px solid var(--text-muted)',
                        background: playerCount === n ? 'rgba(255, 215, 0, 0.1)' : 'var(--bg-card)',
                        color: playerCount === n ? 'var(--accent-gold)' : 'var(--text-primary)',
                        fontFamily: 'var(--font-display)',
                        fontSize: '18px',
                        cursor: 'pointer',
                      }}
                    >
                      {n}
                    </button>
                  ))}
                </div>
              </div>

              {/* Entrants */}
              <div style={{ marginBottom: '24px' }}>
                <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '8px' }}>
                  <label style={{
                    fontFamily: 'var(--font-display)',
                    fontSize: '16px',
                    color: 'var(--text-secondary)',
                    letterSpacing: '2px',
                  }}>
                    ENTRANTS ({entrants.length})
                    {entrants.length < 4 && <span style={{ color: 'var(--accent-red)', marginLeft: '8px' }}>Need {4 - entrants.length} more</span>}
                  </label>
                  {/* Lean Mode - Quick trim buttons */}
                  {entrants.length > 8 && (
                    <div style={{ display: 'flex', gap: '6px' }}>
                      <button
                        onClick={() => setEntrants(entrants.slice(0, 8))}
                        style={{
                          background: 'var(--bg-elevated)',
                          border: '1px solid var(--text-muted)',
                          borderRadius: '6px',
                          padding: '4px 8px',
                          fontSize: '11px',
                          color: 'var(--text-secondary)',
                          cursor: 'pointer',
                        }}
                        title="Keep only top 8 entrants for a faster bracket"
                      >
                        Trim to 8
                      </button>
                      {entrants.length > 16 && (
                        <button
                          onClick={() => setEntrants(entrants.slice(0, 16))}
                          style={{
                            background: 'var(--bg-elevated)',
                            border: '1px solid var(--text-muted)',
                            borderRadius: '6px',
                            padding: '4px 8px',
                            fontSize: '11px',
                            color: 'var(--text-secondary)',
                            cursor: 'pointer',
                          }}
                          title="Keep only top 16 entrants"
                        >
                          Trim to 16
                        </button>
                      )}
                    </div>
                  )}
                </div>
                <div style={{ display: 'flex', gap: '8px', marginBottom: '12px' }}>
                  <Input
                    value={newEntrant}
                    onChange={setNewEntrant}
                    placeholder="Add entrant..."
                    onKeyDown={(e) => e.key === 'Enter' && addEntrant()}
                    style={{ flex: 1 }}
                  />
                  <Button variant="primary" onClick={addEntrant}>+</Button>
                </div>
                <div style={{ display: 'flex', flexWrap: 'wrap', gap: '6px' }}>
                  {entrants.map((e, i) => (
                    <EntrantChip key={e} name={e} index={i} onRemove={() => removeEntrant(i)} />
                  ))}
                </div>
              </div>

              {/* Structure Preview - Compact */}
              {entrants.length >= 4 && structure && (
                <div style={{
                  background: 'var(--bg-card)',
                  borderRadius: '12px',
                  padding: '12px 16px',
                  marginBottom: '24px',
                  fontSize: '14px',
                }}>
                  <span style={{ color: 'var(--text-muted)' }}>Bracket: </span>
                  {structure.type === 'clean' ? (
                    <span style={{ color: 'var(--accent-green)' }}>‚úì Clean ({entrants.length} entrants)</span>
                  ) : (
                    <span style={{ color: 'var(--accent-blue)' }}>
                      {structure.playInGames} play-in{structure.playInGames !== 1 ? 's' : ''}, {structure.byes} bye{structure.byes !== 1 ? 's' : ''}
                    </span>
                  )}
                </div>
              )}
            </div>

            {/* Sticky Footer Actions */}
            <div style={{
              position: 'fixed',
              bottom: 0,
              left: 0,
              right: 0,
              padding: '16px 24px',
              background: 'linear-gradient(to top, var(--bg-deep) 80%, transparent)',
              display: 'flex',
              gap: '12px',
              justifyContent: 'center',
              zIndex: 100,
            }}>
              <Button variant="ghost" onClick={resetGame}>Cancel</Button>
              {categoryType === 'custom' && entrants.length >= 4 && (
                <Button variant="secondary" onClick={saveCustomCategory}>üíæ Save</Button>
              )}
              <Button
                variant="primary"
                size="large"
                onClick={startGame}
                disabled={!canStart}
                className={canStart ? 'lock-in-btn' : ''}
              >
                {canStart ? '‚öîÔ∏è Start Battle!' : `Need ${4 - entrants.length} more`}
              </Button>
            </div>
            {showFeedback && <FeedbackModal onClose={() => setShowFeedback(false)} />}
            {showAdmin && <FeedbackAdmin onClose={() => setShowAdmin(false)} />}
            {showAbout && <AboutModal onClose={() => setShowAbout(false)} />}
            {showLegal && <LegalModal onClose={() => setShowLegal(false)} />}
            {confirmModal && <ConfirmModal message={confirmModal.message} confirmText={confirmModal.confirmText} onConfirm={confirmModal.onConfirm} onCancel={() => setConfirmModal(null)} variant={confirmModal.variant} />}
            {showDevTools && <DevToolsModal onClose={() => setShowDevTools(false)} onClearAll={() => { localStorage.clear(); window.location.reload(); }} onResetFirstVisit={() => { localStorage.removeItem('bob-has-visited'); window.location.reload(); }} onResetVault={() => { setHistory(SEED_VAULT_DATA); }} />}
          </div>
        );
      }

      // PLAYING
      if (screen === 'playing' && bracket) {
        const currentRound = bracket.rounds[currentRoundIndex];
        const currentMatchup = currentRound?.matchups[currentMatchupIndex];
        const isChampionship = currentRound?.name === 'Championship';

        return (
          <div style={{ minHeight: '100vh', padding: '24px', maxWidth: '700px', margin: '0 auto' }}>
            <SettingsButton />
            {showSettings && (
              <SettingsPanel soundEnabled={soundEnabled} onToggleSound={handleToggleSound} onFeedback={() => setShowFeedback(true)} onAdmin={() => setShowAdmin(true)} onAbout={() => setShowAbout(true)} onLegal={() => setShowLegal(true)} onDevTools={() => setShowDevTools(true)} isDevMode={isDevMode} onClose={() => setShowSettings(false)} />
            )}
            
            <Logo size="small" onClick={() => {
              setConfirmModal({
                message: 'Exit bracket? Progress will be lost.',
                confirmText: 'Exit',
                variant: 'warning',
                onConfirm: () => {
                  setConfirmModal(null);
                  resetGame();
                },
              });
            }} />
            
            <div style={{ textAlign: 'center', marginBottom: '16px' }}>
              {/* Year in Review progress indicator */}
              {isYearInReview && (
                <div style={{
                  display: 'flex',
                  justifyContent: 'center',
                  gap: '8px',
                  marginBottom: '12px',
                }}>
                  {[1, 2, 3, 4, 5].map(round => (
                    <div key={round} style={{
                      width: round === 5 ? '40px' : '32px',
                      height: '8px',
                      borderRadius: '4px',
                      background: round < yirRound ? '#ffd700'
                        : round === yirRound ? '#f59e0b'
                        : 'var(--bg-card-hover)',
                      transition: 'background 0.3s',
                    }} title={round === 5 ? 'MVP Final' : `Round ${round}`} />
                  ))}
                </div>
              )}
              {isYearInReview && (
                <div style={{
                  fontSize: '12px',
                  color: '#f59e0b',
                  letterSpacing: '2px',
                  marginBottom: '8px',
                }}>
                  {yirRound === 5 ? 'üèÜ MVP FINAL' : `YEAR IN REVIEW ‚Ä¢ ${yirRound} OF 4`}
                </div>
              )}
              <div style={{
                fontFamily: 'var(--font-display)',
                fontSize: '20px',
                color: 'var(--accent-gold)',
                letterSpacing: '3px',
              }}>
                {category.toUpperCase()}
              </div>
              <div style={{ fontSize: '14px', color: 'var(--text-secondary)', marginTop: '8px' }}>
                Match {currentMatchupIndex + 1} of {currentRound?.matchups.length}
              </div>
            </div>

            <BracketPathView
              rounds={bracket.rounds}
              currentRoundIndex={currentRoundIndex}
              categoryColor={CATEGORY_LIBRARY[categoryType]?.color}
            />

            <BobSays message={bobMessage} mood={bobMood} />

            {currentMatchup && (
              <MatchupCard
                key={currentMatchup.id}
                matchup={currentMatchup}
                onVote={handleVoteResult}
                playerCount={playerCount}
                isChampionship={isChampionship}
                categoryType={categoryType}
              />
            )}

            {/* First-time hint - only on first matchup of first round */}
            {currentRoundIndex === 0 && currentMatchupIndex === 0 && winners.length === 0 && (
              <div style={{
                marginTop: '16px',
                padding: '12px 16px',
                background: 'var(--bg-card)',
                borderRadius: '12px',
                border: '1px dashed var(--text-muted)',
                textAlign: 'center',
                fontSize: '13px',
                color: 'var(--text-secondary)',
              }}>
                üí° <strong>How to play:</strong> Tally votes with +1/-1 (or ‚Üê ‚Üí keys), then tap "Lock In Result" (or Enter)
              </div>
            )}

            <div style={{ marginTop: '16px', textAlign: 'center', color: 'var(--text-muted)', fontSize: '13px' }}>
              {winners.length} of {currentRound?.matchups.length + (currentRound?.byes?.length || 0)} advancing
            </div>

            {/* Undo button - 5 second window */}
            {canUndo && (
              <div style={{
                marginTop: '16px',
                textAlign: 'center',
                animation: 'slideUp 0.3s ease-out',
              }}>
                <Button
                  variant="ghost"
                  size="small"
                  onClick={handleUndo}
                  style={{ opacity: 0.8 }}
                >
                  ‚Ü© Wait, go back
                </Button>
              </div>
            )}
            {showFeedback && <FeedbackModal onClose={() => setShowFeedback(false)} />}
            {showAdmin && <FeedbackAdmin onClose={() => setShowAdmin(false)} />}
            {showAbout && <AboutModal onClose={() => setShowAbout(false)} />}
            {showLegal && <LegalModal onClose={() => setShowLegal(false)} />}
            {confirmModal && <ConfirmModal message={confirmModal.message} confirmText={confirmModal.confirmText} onConfirm={confirmModal.onConfirm} onCancel={() => setConfirmModal(null)} variant={confirmModal.variant} />}
            {showDevTools && <DevToolsModal onClose={() => setShowDevTools(false)} onClearAll={() => { localStorage.clear(); window.location.reload(); }} onResetFirstVisit={() => { localStorage.removeItem('bob-has-visited'); window.location.reload(); }} onResetVault={() => { setHistory(SEED_VAULT_DATA); }} />}
          </div>
        );
      }

      // CHAMPION
      if (screen === 'champion') {
        return (
          <>
            <SettingsButton />
            {showSettings && (
              <SettingsPanel soundEnabled={soundEnabled} onToggleSound={handleToggleSound} onFeedback={() => setShowFeedback(true)} onAdmin={() => setShowAdmin(true)} onAbout={() => setShowAbout(true)} onLegal={() => setShowLegal(true)} onDevTools={() => setShowDevTools(true)} isDevMode={isDevMode} onClose={() => setShowSettings(false)} />
            )}
            <ChampionScreen
              champion={champion}
              category={category}
              runnerUp={runnerUp}
              categoryType={categoryType}
              bobComment={championComment}
              entrants={entrants}
              playerCount={playerCount}
              matchupResults={finalBracketResults}
              onNewGame={() => setScreen('library')}
              onViewVault={() => setScreen('vault')}
            />
            {showFeedback && <FeedbackModal onClose={() => setShowFeedback(false)} />}
            {showAdmin && <FeedbackAdmin onClose={() => setShowAdmin(false)} />}
            {showAbout && <AboutModal onClose={() => setShowAbout(false)} />}
            {showLegal && <LegalModal onClose={() => setShowLegal(false)} />}
            {confirmModal && <ConfirmModal message={confirmModal.message} confirmText={confirmModal.confirmText} onConfirm={confirmModal.onConfirm} onCancel={() => setConfirmModal(null)} variant={confirmModal.variant} />}
            {showDevTools && <DevToolsModal onClose={() => setShowDevTools(false)} onClearAll={() => { localStorage.clear(); window.location.reload(); }} onResetFirstVisit={() => { localStorage.removeItem('bob-has-visited'); window.location.reload(); }} onResetVault={() => { setHistory(SEED_VAULT_DATA); }} />}
          </>
        );
      }

      return null;
    }

    ReactDOM.createRoot(document.getElementById('root')).render(<App />);
  </script>
</body>
</html>
